import{aM as x,o as f,c as R,a as k,e as m,Y as V,d as W,g as b,u as r,f as j,aj as A,F as U,X as O,aN as L,w as M,aH as H,r as S,b as v,a5 as P,ad as q,n as z}from"./main.js";import{f as D,c as E}from"./counter1.js";import{_ as I}from"./-plugin-vue-export-helper1.js";import{N as K}from"./Tag1.js";import{N as $,a as X,_ as Y}from"./Popup1.js";import{s as F,W as B}from"./WordList1.js";import{N as G}from"./Select1.js";import{N as J,a as Q}from"./Space1.js";import{a as C}from"./articles1.js";import{u as T}from"./userDict1.js";import{g as Z,a as _}from"./dict1.js";import"./Suffix1.js";import"./use-form-item1.js";import"./lc1.js";const ee={class:"sticky-top"},ne={class:"stats-info"},te={class:"article"},oe=["data-token"],ae=b(" "+m(" ")),se={__name:"ReadingView",props:{article:{type:Object},data:{type:Object},toggleTrans:{type:Function},onRemove:{type:Function}},emits:["updateUserDict"],setup(e,{emit:g}){const{article:l,data:p,toggleTrans:i,onRemove:d}=e,y=()=>{g("updateUserDict"),s.markUnknownWord=!1},s=x({markUnknownWord:!1,highlight:!0,showTrans:!1,showByTokens:!0}),N=c=>{var u,h,a,o;c=D(c);const t=(o=(a=(h=(u=p.translations[c])==null?void 0:u.translation)==null?void 0:h.split(".")[1])==null?void 0:a.split(",")[0])==null?void 0:o.split("\\")[0];return s.showTrans&&t?`${t.trim()}`:""},n=async c=>{var u;let t=(u=c.target)==null?void 0:u.getAttribute("data-token");!t||(t=D(t),s.markUnknownWord?p.unknownWord.includes(t)?d("unknown",t):p.knownWord.includes(t)?d("known",t):d("unseen",t):i(t))};return(c,t)=>(f(),R(U,null,[k("h2",null,m(e.article.title),1),e.article.tag?(f(),V(r(K),{key:0,type:"info"},{default:W(()=>[b(m(e.article.tag),1)]),_:1})):j("",!0),k("div",ee,[k("div",ne," \u5171"+m(e.article.totalWords)+"\u8BCD\uFF0C\u751F\u8BCD\u7387"+m((e.data.unknownWord.length/(e.data.knownWord.length+e.data.unknownWord.length)*100).toFixed(2))+"% ",1),Object.keys(e.data.translations).length?(f(),R("button",{key:0,onClick:t[0]||(t[0]=u=>s.showTrans=!s.showTrans)},m(s.showTrans?"\u9690\u85CF":"\u663E\u793A")+"\u8BCD\u8BD1 ",1)):j("",!0),k("button",{onClick:t[1]||(t[1]=u=>s.showByTokens=!s.showByTokens)},m(s.showByTokens?"\u663E\u793A":"\u9690\u85CF")+"\u53E5\u8BD1",1),k("button",{onClick:t[2]||(t[2]=u=>s.markUnknownWord=!s.markUnknownWord)},m(s.markUnknownWord?"\u505C\u6B62\u6807\u8BB0":"\u5F00\u59CB\u6807\u8BB0"),1),k("button",{onClick:y},"\u66F4\u65B0\u8BCD\u8868"),A(c.$slots,"default",{},void 0,!0)]),k("p",te,[(f(!0),R(U,null,O(e.article.sentences,(u,h)=>(f(),R("p",{key:"paragraph"+h},[(f(!0),R(U,null,O(u,(a,o)=>(f(),R("span",{key:a.sentence.slice(0,5)+o},[k("span",{class:"origin-sentence",onClick:n},[(f(!0),R(U,null,O(a.tokens,w=>(f(),R("span",{class:L({"token--unseen":s.highlight&&e.data.unseenWord.includes(r(D)(w)),"token--unknown":s.highlight&&e.data.unknownWord.includes(r(D)(w))})},[k("ruby",{"data-token":w},[b(m(w),1),k("rt",null,m(N(w)),1)],8,oe),ae],2))),256))]),M(k("div",{class:"translate-sentence"},m(a.translation),513),[[H,!s.showByTokens]])]))),128))]))),128))])],64))}},re=I(se,[["__scopeId","data-v-95021274"]]),le=b(" \u8BCD\u8868 "),de={__name:"WordListPopup",props:{data:{type:Object},onRemove:{type:Function}},setup(e){const g=S(F[0].value),l=x({allowRemove:!1});return(p,i)=>(f(),V(Y,{btnText:"\u67E5\u770B\u8BCD\u8868"},{header:W(()=>[v(r(Q),null,{default:W(()=>[le,v(r(G),{value:g.value,"onUpdate:value":i[0]||(i[0]=d=>g.value=d),options:r(F),placeholder:"\u6392\u5E8F\u65B9\u5F0F"},null,8,["value","options"]),v(r(J),{onClick:i[1]||(i[1]=d=>l.allowRemove=!l.allowRemove)},{default:W(()=>[b(m(l.allowRemove?"\u53D6\u6D88":"")+"\u7F16\u8F91 ",1)]),_:1})]),_:1})]),default:W(()=>[v(r(X),{type:"segment"},{default:W(()=>[v(r($),{name:"0",tab:`\u751F\u8BCD (\u5171${e.data.unknownWord.length}\u4E2A)`},{default:W(()=>[v(B,{words:e.data.unknownWord,wordDict:e.data.translations,selectedOrder:g.value,allowRemove:l.allowRemove,onRemove:i[2]||(i[2]=d=>e.onRemove("unknown",d))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),v(r($),{name:"1",tab:`\u672A\u6807\u8BB0\u8BCD (\u5171${e.data.unseenWord.length}\u4E2A)`},{default:W(()=>[v(B,{words:e.data.unseenWord,wordDict:e.data.translations,selectedOrder:g.value,allowRemove:l.allowRemove,onRemove:i[3]||(i[3]=d=>e.onRemove("unseen",d))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),v(r($),{name:"2",tab:`\u719F\u8BCD (\u5171${e.data.knownWord.length}\u4E2A)`},{default:W(()=>[v(B,{words:e.data.knownWord,wordDict:e.data.translations,selectedOrder:g.value,allowRemove:l.allowRemove,onRemove:i[4]||(i[4]=d=>e.onRemove("known",d))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"])]),_:1})]),_:1}))}},Te={__name:"article",setup(e){const g=()=>{const n=x({knownWord:[],unseenWord:[],unknownWord:[],translations:{}}),c=()=>{T.addKnownWords([...n.knownWord,...n.unseenWord]),T.addUnknownWords(n.unknownWord),T.save(),n.unseenWord=[]};function t(a,o){a==="unknown"?(n.knownWord.push(o),n.unknownWord=n.unknownWord.filter(w=>w!==o),delete n.translations[o]):a==="known"?(n.unknownWord.push(o),n.knownWord=n.knownWord.filter(w=>w!==o),h(o)):(n.unknownWord.push(o),n.unseenWord=n.unseenWord.filter(w=>w!==o))}const u=a=>{a in n.translations?delete n.translations[a]:h(a)},h=async a=>{if(typeof a=="string"){const o=await Z(a);n.translations[a]=o,console.log(o)}else{const o=await _({words:a});Object.assign(n.translations,o),console.log(o)}};return z(()=>{T.save()}),{data:n,toggleTrans:u,updateUserDict:c,onRemove:t}},{data:l,toggleTrans:p,updateUserDict:i,onRemove:d}=g(),y=S({}),s=P(),N=()=>{i(),C.markArticle("hasMarked",y.value)};return q(async()=>{const n=s.params.id,c=await C.getArticle(n);y.value=c,document.title=c.title+" - \u4F60\u7684\u5B9A\u5236\u82F1\u8BED\u8BCD\u5178";const{known:t,unknown:u,unseen:h}=E(y.value.wordsUnique,T.knownWords,T.unknownWords);l.unknownWord=u,l.unseenWord=h,l.knownWord=t,p([...l.unknownWord,...l.unseenWord]),C.markArticle("hasOpened",y.value)}),(n,c)=>(f(),V(re,{article:y.value,data:r(l),onUpdateUserDict:N,onRemove:r(d),toggleTrans:r(p)},{default:W(()=>[v(de,{data:r(l),onRemove:r(d)},null,8,["data","onRemove"])]),_:1},8,["article","data","onRemove","toggleTrans"]))}};export{Te as default};
