import{k as C,l as L,r as S,o as k,g as j,e as f,d as w,u as a,j as T,f as u,c as v,a as c,b as x,F as D,n as B,p as _,w as q,h as P}from"./main.js";import{c as z,f as N}from"./counter.js";import{g as A,a as E}from"./dict.js";import{u as R,N as I}from"./userDict.js";import{N as O,a as K,_ as G}from"./Popup.js";import{s as V,N as H,a as J,W as $}from"./WordList.js";import{N as M}from"./Select.js";import{_ as Q}from"./-plugin-vue-export-helper.js";const X=o=>{const n=C({knownWord:[],unseenWord:[],unknownWord:[],translations:{}}),i=()=>{R.addKnownWords([...n.knownWord,...n.unseenWord]),R.addUnknownWords(n.unknownWord),R.save(),n.unseenWord=[]};function l(r,e){r==="unknown"?(n.knownWord.push(e),n.unknownWord=n.unknownWord.filter(W=>W!==e),delete n.translations[e]):r==="known"?(n.unknownWord.push(e),n.knownWord=n.knownWord.filter(W=>W!==e),d(e)):(n.unknownWord.push(e),n.unseenWord=n.unseenWord.filter(W=>W!==e))}const s=r=>{r in n.translations?delete n.translations[r]:d(r)},d=async r=>{if(typeof r=="string"){const e=await A(r);n.translations[r]=e,console.log(e)}else{const e=await E({words:r});Object.assign(n.translations,e),console.log(e)}};return L(()=>{R.save()}),(()=>{const{known:r,unknown:e,unseen:W}=z(o,R.knownWords,R.unknownWords);n.unknownWord=e,n.unseenWord=W,n.knownWord=r,s([...n.unknownWord,...n.unseenWord])})(),{data:n,toggleTrans:s,updateUserDict:i,onRemove:l}},Y=T(" \u8BCD\u8868 "),Z={__name:"WordListPopup",props:{data:{type:Object},onRemove:{type:Function}},setup(o){const n=S(V[0].value),i=C({allowRemove:!1});return(l,s)=>(k(),j(G,{btnText:"\u67E5\u770B\u8BCD\u8868"},{header:f(()=>[w(a(J),null,{default:f(()=>[Y,w(a(M),{value:n.value,"onUpdate:value":s[0]||(s[0]=d=>n.value=d),options:a(V),placeholder:"\u6392\u5E8F\u65B9\u5F0F"},null,8,["value","options"]),w(a(H),{onClick:s[1]||(s[1]=d=>i.allowRemove=!i.allowRemove)},{default:f(()=>[T(u(i.allowRemove?"\u53D6\u6D88":"")+"\u7F16\u8F91 ",1)]),_:1})]),_:1})]),default:f(()=>[w(a(K),{type:"segment"},{default:f(()=>[w(a(O),{name:"0",tab:`\u751F\u8BCD (\u5171${o.data.unknownWord.length}\u4E2A)`},{default:f(()=>[w($,{words:o.data.unknownWord,wordDict:o.data.translations,selectedOrder:n.value,allowRemove:i.allowRemove,onRemove:s[2]||(s[2]=d=>o.onRemove("unknown",d))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),w(a(O),{name:"1",tab:`\u672A\u6807\u8BB0\u8BCD (\u5171${o.data.unseenWord.length}\u4E2A)`},{default:f(()=>[w($,{words:o.data.unseenWord,wordDict:o.data.translations,selectedOrder:n.value,allowRemove:i.allowRemove,onRemove:s[3]||(s[3]=d=>o.onRemove("unseen",d))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),w(a(O),{name:"2",tab:`\u719F\u8BCD (\u5171${o.data.knownWord.length}\u4E2A)`},{default:f(()=>[w($,{words:o.data.knownWord,wordDict:o.data.translations,selectedOrder:n.value,allowRemove:i.allowRemove,onRemove:s[4]||(s[4]=d=>o.onRemove("known",d))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"])]),_:1})]),_:1}))}};const nn={class:"sticky-top"},en={class:"stats-info"},on={class:"article"},tn=["data-token"],an=T(" "+u(" ")),sn={__name:"ReadingView",props:{article:{type:Object}},emits:["updateUserDict"],setup(o,{emit:n}){const{article:i}=o;console.log("article",i),console.log("article.wordsUnique",i.wordsUnique);const{data:l,toggleTrans:s,updateUserDict:d,onRemove:p}=X(i.wordsUnique),r=()=>{n("updateUserDict"),d(),e.markUnknownWord=!1},e=C({markUnknownWord:!1,highlight:!0,showTrans:!1,showByTokens:!0}),W=g=>{var m,b,h,U;g=N(g);const t=(U=(h=(b=(m=l.translations[g])==null?void 0:m.translation)==null?void 0:b.split(".")[1])==null?void 0:h.split(",")[0])==null?void 0:U.split("\\")[0];return e.showTrans&&t?`${t.trim()}`:""},F=async g=>{var m;let t=(m=g.target)==null?void 0:m.getAttribute("data-token");!t||(t=N(t),e.markUnknownWord?l.unknownWord.includes(t)?p("unknown",t):l.knownWord.includes(t)?p("known",t):p("unseen",t):s(t))};return(g,t)=>(k(),v(D,null,[c("h2",null,u(o.article.title),1),o.article.tag?(k(),j(a(I),{key:0,type:"info"},{default:f(()=>[T(u(o.article.tag),1)]),_:1})):x("",!0),c("div",nn,[c("div",en," \u5171"+u(o.article.totalWords)+"\u8BCD\uFF0C\u751F\u8BCD\u7387"+u((a(l).unknownWord.length/(a(l).knownWord.length+a(l).unknownWord.length)*100).toFixed(2))+"% ",1),Object.keys(a(l).translations).length?(k(),v("button",{key:0,onClick:t[0]||(t[0]=m=>e.showTrans=!e.showTrans)},u(e.showTrans?"\u9690\u85CF":"\u663E\u793A")+"\u8BCD\u8BD1 ",1)):x("",!0),c("button",{onClick:t[1]||(t[1]=m=>e.showByTokens=!e.showByTokens)},u(e.showByTokens?"\u663E\u793A":"\u9690\u85CF")+"\u53E5\u8BD1",1),c("button",{onClick:t[2]||(t[2]=m=>e.markUnknownWord=!e.markUnknownWord)},u(e.markUnknownWord?"\u505C\u6B62\u6807\u8BB0":"\u5F00\u59CB\u6807\u8BB0"),1),c("button",{onClick:r},"\u66F4\u65B0\u8BCD\u8868"),w(Z,{data:a(l),onRemove:a(p)},null,8,["data","onRemove"])]),c("p",on,[(k(!0),v(D,null,B(o.article.sentences,(m,b)=>(k(),v("p",{key:"paragraph"+b},[(k(!0),v(D,null,B(m,(h,U)=>(k(),v("span",{key:h.sentence.slice(0,5)+U},[c("span",{class:"origin-sentence",onClick:F},[(k(!0),v(D,null,B(h.tokens,y=>(k(),v("span",{class:_({"token--unseen":e.highlight&&a(l).unseenWord.includes(a(N)(y)),"token--unknown":e.highlight&&a(l).unknownWord.includes(a(N)(y))})},[c("ruby",{"data-token":y},[T(u(y),1),c("rt",null,u(W(y)),1)],8,tn),an],2))),256))]),q(c("div",{class:"translate-sentence"},u(h.translation),513),[[P,!e.showByTokens]])]))),128))]))),128))])],64))}},Wn=Q(sn,[["__scopeId","data-v-44057d0f"]]);export{Wn as R};
