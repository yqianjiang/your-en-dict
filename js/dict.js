import{L as Bn}from"./lc.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var I=function(){return I=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},I.apply(this,arguments)};function Dt(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,a;r<i;r++)(a||!(r in e))&&(a||(a=Array.prototype.slice.call(e,0,r)),a[r]=e[r]);return t.concat(a||Array.prototype.slice.call(e))}var M=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,j=Object.keys,z=Array.isArray;typeof Promise<"u"&&!M.Promise&&(M.Promise=Promise);function U(t,e){return typeof e!="object"||j(e).forEach(function(n){t[n]=e[n]}),t}var Le=Object.getPrototypeOf,pr={}.hasOwnProperty;function Y(t,e){return pr.call(t,e)}function Ce(t,e){typeof e=="function"&&(e=e(Le(t))),(typeof Reflect>"u"?j:Reflect.ownKeys)(e).forEach(function(n){oe(t,n,e[n])})}var On=Object.defineProperty;function oe(t,e,n,r){On(t,e,U(n&&Y(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function ke(t){return{from:function(e){return t.prototype=Object.create(e.prototype),oe(t.prototype,"constructor",t),{extend:Ce.bind(null,t.prototype)}}}}var yr=Object.getOwnPropertyDescriptor;function en(t,e){var n=yr(t,e),r;return n||(r=Le(t))&&en(r,e)}var mr=[].slice;function bt(t,e,n){return mr.call(t,e,n)}function Mn(t,e){return e(t)}function Be(t){if(!t)throw new Error("Assertion Failed")}function Fn(t){M.setImmediate?setImmediate(t):setTimeout(t,0)}function jn(t,e){return t.reduce(function(n,r,i){var a=e(r,i);return a&&(n[a[0]]=a[1]),n},{})}function gr(t,e,n){try{t.apply(null,n)}catch(r){e&&e(r)}}function ue(t,e){if(Y(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,i=e.length;r<i;++r){var a=ue(t,e[r]);n.push(a)}return n}var u=e.indexOf(".");if(u!==-1){var o=t[e.substr(0,u)];return o===void 0?void 0:ue(o,e.substr(u+1))}}function J(t,e,n){if(!(!t||e===void 0)&&!("isFrozen"in Object&&Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Be(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)J(t,e[r],n[r])}else{var a=e.indexOf(".");if(a!==-1){var u=e.substr(0,a),o=e.substr(a+1);if(o==="")n===void 0?z(t)&&!isNaN(parseInt(u))?t.splice(u,1):delete t[u]:t[u]=n;else{var s=t[u];(!s||!Y(t,u))&&(s=t[u]={}),J(s,o,n)}}else n===void 0?z(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function br(t,e){typeof e=="string"?J(t,e,void 0):"length"in e&&[].map.call(e,function(n){J(t,n,void 0)})}function Ln(t){var e={};for(var n in t)Y(t,n)&&(e[n]=t[n]);return e}var wr=[].concat;function Nn(t){return wr.apply([],t)}var Vn="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Nn([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return M[t]}),_r=Vn.map(function(t){return M[t]});jn(Vn,function(t){return[t,!0]});var he=null;function Ye(t){he=typeof WeakMap<"u"&&new WeakMap;var e=It(t);return he=null,e}function It(t){if(!t||typeof t!="object")return t;var e=he&&he.get(t);if(e)return e;if(z(t)){e=[],he&&he.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(It(t[n]))}else if(_r.indexOf(t.constructor)>=0)e=t;else{var i=Le(t);e=i===Object.prototype?{}:Object.create(i),he&&he.set(t,e);for(var a in t)Y(t,a)&&(e[a]=It(t[a]))}return e}var xr={}.toString;function Pt(t){return xr.call(t).slice(8,-1)}var Rt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Er=typeof Rt=="symbol"?function(t){var e;return t!=null&&(e=t[Rt])&&e.apply(t)}:function(){return null},Se={};function ie(t){var e,n,r,i;if(arguments.length===1){if(z(t))return t.slice();if(this===Se&&typeof t=="string")return[t];if(i=Er(t)){for(n=[];r=i.next(),!r.done;)n.push(r.value);return n}if(t==null)return[t];if(e=t.length,typeof e=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var tn=typeof Symbol<"u"?function(t){return t[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},te=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function zn(t,e){te=t,Wn=e}var Wn=function(){return!0},Ar=!new Error("").stack;function Ee(){if(Ar)try{throw Ee.arguments,new Error}catch(t){return t}return new Error}function Bt(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(Wn).map(function(r){return`
`+r}).join("")):""}var Kr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"],Un=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],nn=Kr.concat(Un),Sr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function De(t,e){this._e=Ee(),this.name=t,this.message=e}ke(De).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Bt(this._e,2))}},toString:function(){return this.name+": "+this.message}});function Hn(t,e){return t+". Errors: "+Object.keys(e).map(function(n){return e[n].toString()}).filter(function(n,r,i){return i.indexOf(n)===r}).join(`
`)}function lt(t,e,n,r){this._e=Ee(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Hn(t,e)}ke(lt).from(De);function Me(t,e){this._e=Ee(),this.name="BulkError",this.failures=Object.keys(e).map(function(n){return e[n]}),this.failuresByPos=e,this.message=Hn(t,e)}ke(Me).from(De);var rn=nn.reduce(function(t,e){return t[e]=e+"Error",t},{}),Tr=De,C=nn.reduce(function(t,e){var n=e+"Error";function r(i,a){this._e=Ee(),this.name=n,i?typeof i=="string"?(this.message=""+i+(a?`
 `+a:""),this.inner=a||null):typeof i=="object"&&(this.message=i.name+" "+i.message,this.inner=i):(this.message=Sr[e]||n,this.inner=null)}return ke(r).from(Tr),t[e]=r,t},{});C.Syntax=SyntaxError;C.Type=TypeError;C.Range=RangeError;var bn=Un.reduce(function(t,e){return t[e+"Error"]=C[e],t},{});function Cr(t,e){if(!t||t instanceof De||t instanceof TypeError||t instanceof SyntaxError||!t.name||!bn[t.name])return t;var n=new bn[t.name](e||t.message,t);return"stack"in t&&oe(n,"stack",{get:function(){return this.inner.stack}}),n}var wt=nn.reduce(function(t,e){return["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=C[e]),t},{});wt.ModifyError=lt;wt.DexieError=De;wt.BulkError=Me;function O(){}function Qe(t){return t}function kr(t,e){return t==null||t===Qe?e:function(n){return e(t(n))}}function _e(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Dr(t,e){return t===O?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?_e(r,this.onsuccess):r),i&&(this.onerror=this.onerror?_e(i,this.onerror):i),a!==void 0?a:n}}function Ir(t,e){return t===O?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?_e(n,this.onsuccess):n),r&&(this.onerror=this.onerror?_e(r,this.onerror):r)}}function Pr(t,e){return t===O?e:function(n){var r=t.apply(this,arguments);U(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var u=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?_e(i,this.onsuccess):i),a&&(this.onerror=this.onerror?_e(a,this.onerror):a),r===void 0?u===void 0?void 0:u:U(r,u)}}function Rr(t,e){return t===O?e:function(){return e.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function an(t,e){return t===O?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return n.then(function(){return e.apply(r,a)})}return e.apply(this,arguments)}}var Ne={},Br=100,Or=20,Yn=100,un=typeof Promise>"u"?[]:function(){var t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Le(t),t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Le(e),t]}(),Ot=un[0],ft=un[1],Mt=un[2],Qn=ft&&ft.then,it=Ot&&Ot.constructor,on=!!Mt,Ft=!1,Mr=Mt?function(){Mt.then(Ze)}:M.setImmediate?setImmediate.bind(null,Ze):M.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){Ze(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(Ze,0)},Ve=function(t,e){Oe.push([t,e]),ht&&(Mr(),ht=!1)},jt=!0,ht=!0,be=[],at=[],Lt=null,Nt=Qe,Te={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:xn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{xn(t[0],t[1])}catch{}})}},K=Te,Oe=[],we=0,ut=[];function A(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=O,this._lib=!1;var e=this._PSD=K;if(te&&(this._stackHolder=Ee(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Ne)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&zt(this,this._value);return}this._state=null,this._value=null,++e.ref,Gn(this,t)}var Vt={get:function(){var t=K,e=dt;function n(r,i){var a=this,u=!t.global&&(t!==K||e!==dt),o=u&&!se(),s=new A(function(c,f){sn(a,new Xn(pt(r,t,u,o),pt(i,t,u,o),c,f,t))});return te&&$n(s,this),s}return n.prototype=Ne,n},set:function(t){oe(this,"then",t&&t.prototype===Ne?Vt:{get:function(){return t},set:Vt.set})}};Ce(A.prototype,{then:Vt,_then:function(t,e){sn(this,new Xn(null,null,t,e,K))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,function(r){return r instanceof e?n(r):ot(r)}):this.then(null,function(r){return r&&r.name===e?n(r):ot(r)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),ot(e)})},stack:{get:function(){if(this._stack)return this._stack;try{Ft=!0;var t=Jn(this,[],Or),e=t.join(`
From previous: `);return this._state!==null&&(this._stack=e),e}finally{Ft=!1}}},timeout:function(t,e){var n=this;return t<1/0?new A(function(r,i){var a=setTimeout(function(){return i(new C.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,a))}):this}});typeof Symbol<"u"&&Symbol.toStringTag&&oe(A.prototype,Symbol.toStringTag,"Dexie.Promise");Te.env=Zn();function Xn(t,e,n,r,i){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=i}Ce(A,{all:function(){var t=ie.apply(null,arguments).map(vt);return new A(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach(function(i,a){return A.resolve(i).then(function(u){t[a]=u,--r||e(t)},n)})})},resolve:function(t){if(t instanceof A)return t;if(t&&typeof t.then=="function")return new A(function(n,r){t.then(n,r)});var e=new A(Ne,!0,t);return $n(e,Lt),e},reject:ot,race:function(){var t=ie.apply(null,arguments).map(vt);return new A(function(e,n){t.map(function(r){return A.resolve(r).then(e,n)})})},PSD:{get:function(){return K},set:function(t){return K=t}},totalEchoes:{get:function(){return dt}},newPSD:ve,usePSD:Pe,scheduler:{get:function(){return Ve},set:function(t){Ve=t}},rejectionMapper:{get:function(){return Nt},set:function(t){Nt=t}},follow:function(t,e){return new A(function(n,r){return ve(function(i,a){var u=K;u.unhandleds=[],u.onunhandled=a,u.finalize=_e(function(){var o=this;jr(function(){o.unhandleds.length===0?i():a(o.unhandleds[0])})},u.finalize),t()},e,n,r)})}});it&&(it.allSettled&&oe(A,"allSettled",function(){var t=ie.apply(null,arguments).map(vt);return new A(function(e){t.length===0&&e([]);var n=t.length,r=new Array(n);t.forEach(function(i,a){return A.resolve(i).then(function(u){return r[a]={status:"fulfilled",value:u}},function(u){return r[a]={status:"rejected",reason:u}}).then(function(){return--n||e(r)})})})}),it.any&&typeof AggregateError<"u"&&oe(A,"any",function(){var t=ie.apply(null,arguments).map(vt);return new A(function(e,n){t.length===0&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(a,u){return A.resolve(a).then(function(o){return e(o)},function(o){i[u]=o,--r||n(new AggregateError(i))})})})}));function Gn(t,e){try{e(function(n){if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Xe();n&&typeof n.then=="function"?Gn(t,function(i,a){n instanceof A?n._then(i,a):n.then(i,a)}):(t._state=!0,t._value=n,qn(t)),r&&Ge()}},zt.bind(null,t))}catch(n){zt(t,n)}}function zt(t,e){if(at.push(e),t._state===null){var n=t._lib&&Xe();e=Nt(e),t._state=!1,t._value=e,te&&e!==null&&typeof e=="object"&&!e._promise&&gr(function(){var r=en(e,"stack");e._promise=t,oe(e,"stack",{get:function(){return Ft?r&&(r.get?r.get.apply(e):r.value):t.stack}})}),Lr(t),qn(t),n&&Ge()}}function qn(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)sn(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),we===0&&(++we,Ve(function(){--we===0&&cn()},[]))}function sn(t,e){if(t._state===null){t._listeners.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++we,Ve(Fr,[n,t,e])}function Fr(t,e,n){try{Lt=e;var r,i=e._value;e._state?r=t(i):(at.length&&(at=[]),r=t(i),at.indexOf(i)===-1&&Nr(e)),n.resolve(r)}catch(a){n.reject(a)}finally{Lt=null,--we===0&&cn(),--n.psd.ref||n.psd.finalize()}}function Jn(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var i=t._value,a,u;i!=null?(a=i.name||"Error",u=i.message||i,r=Bt(i,0)):(a=i,u=""),e.push(a+(u?": "+u:"")+r)}return te&&(r=Bt(t._stackHolder,2),r&&e.indexOf(r)===-1&&e.push(r),t._prev&&Jn(t._prev,e,n)),e}function $n(t,e){var n=e?e._numPrev+1:0;n<Br&&(t._prev=e,t._numPrev=n)}function Ze(){Xe()&&Ge()}function Xe(){var t=jt;return jt=!1,ht=!1,t}function Ge(){var t,e,n;do for(;Oe.length>0;)for(t=Oe,Oe=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(Oe.length>0);jt=!0,ht=!0}function cn(){var t=be;be=[],t.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)});for(var e=ut.slice(0),n=e.length;n;)e[--n]()}function jr(t){function e(){t(),ut.splice(ut.indexOf(e),1)}ut.push(e),++we,Ve(function(){--we===0&&cn()},[])}function Lr(t){be.some(function(e){return e._value===t._value})||be.push(t)}function Nr(t){for(var e=be.length;e;)if(be[--e]._value===t._value){be.splice(e,1);return}}function ot(t){return new A(Ne,!1,t)}function F(t,e){var n=K;return function(){var r=Xe(),i=K;try{return pe(n,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{pe(i,!1),r&&Ge()}}}var V={awaits:0,echoes:0,id:0},Vr=0,st=[],Et=0,dt=0,zr=0;function ve(t,e,n,r){var i=K,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++zr;var u=Te.env;a.env=on?{Promise:A,PromiseProp:{value:A,configurable:!0,writable:!0},all:A.all,race:A.race,allSettled:A.allSettled,any:A.any,resolve:A.resolve,reject:A.reject,nthen:wn(u.nthen,a),gthen:wn(u.gthen,a)}:{},e&&U(a,e),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Pe(a,t,n,r);return a.ref===0&&a.finalize(),o}function Ie(){return V.id||(V.id=++Vr),++V.awaits,V.echoes+=Yn,V.id}function se(){return V.awaits?(--V.awaits===0&&(V.id=0),V.echoes=V.awaits*Yn,!0):!1}(""+Qn).indexOf("[native code]")===-1&&(Ie=se=O);function vt(t){return V.echoes&&t&&t.constructor===it?(Ie(),t.then(function(e){return se(),e},function(e){return se(),L(e)})):t}function Wr(t){++dt,(!V.echoes||--V.echoes===0)&&(V.echoes=V.id=0),st.push(K),pe(t,!0)}function Ur(){var t=st[st.length-1];st.pop(),pe(t,!1)}function pe(t,e){var n=K;if((e?V.echoes&&(!Et++||t!==K):Et&&(!--Et||t!==K))&&er(e?Wr.bind(null,t):Ur),t!==K&&(K=t,n===Te&&(Te.env=Zn()),on)){var r=Te.env.Promise,i=t.env;ft.then=i.nthen,r.prototype.then=i.gthen,(n.global||t.global)&&(Object.defineProperty(M,"Promise",i.PromiseProp),r.all=i.all,r.race=i.race,r.resolve=i.resolve,r.reject=i.reject,i.allSettled&&(r.allSettled=i.allSettled),i.any&&(r.any=i.any))}}function Zn(){var t=M.Promise;return on?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(M,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:ft.then,gthen:t.prototype.then}:{}}function Pe(t,e,n,r,i){var a=K;try{return pe(t,!0),e(n,r,i)}finally{pe(a,!1)}}function er(t){Qn.call(Ot,t)}function pt(t,e,n,r){return typeof t!="function"?t:function(){var i=K;n&&Ie(),pe(e,!0);try{return t.apply(this,arguments)}finally{pe(i,!1),r&&er(se)}}}function wn(t,e){return function(n,r){return t.call(this,pt(n,e),pt(r,e))}}var _n="unhandledrejection";function xn(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,i={promise:e,reason:t};if(M.document&&document.createEvent?(r=document.createEvent("Event"),r.initEvent(_n,!0,!0),U(r,i)):M.CustomEvent&&(r=new CustomEvent(_n,{detail:i}),U(r,i)),r&&M.dispatchEvent&&(dispatchEvent(r),!M.PromiseRejectionEvent&&M.onunhandledrejection))try{M.onunhandledrejection(r)}catch{}te&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch{}}var L=A.reject;function Wt(t,e,n,r){if(!t.idbdb||!t._state.openComplete&&!K.letThrough&&!t._vip){if(t._state.openComplete)return L(new C.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return L(new C.DatabaseClosed);t.open().catch(O)}return t._state.dbReadyPromise.then(function(){return Wt(t,e,n,r)})}else{var i=t._createTransaction(e,n,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===rn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return Wt(t,e,n,r)})):L(a)}return i._promise(e,function(a,u){return ve(function(){return K.trans=i,r(a,u,i)})}).then(function(a){return i._completion.then(function(){return a})})}}var En="3.2.2",ge=String.fromCharCode(65535),Ut=-1/0,ne="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",tr="String expected.",Fe=[],_t=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Hr=_t,Yr=_t,nr=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},xt="__dbnames",At="readonly",Kt="readwrite";function xe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var rr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function et(t){return typeof t=="string"&&!/\./.test(t)?function(e){return e[t]===void 0&&t in e&&(e=Ye(e),delete e[t]),e}:function(e){return e}}var Qr=function(){function t(){}return t.prototype._trans=function(e,n,r){var i=this._tx||K.trans,a=this.name;function u(s,c,f){if(!f.schema[a])throw new C.NotFound("Table "+a+" not part of transaction");return n(f.idbtrans,f)}var o=Xe();try{return i&&i.db===this.db?i===K.trans?i._promise(e,u,r):ve(function(){return i._promise(e,u,r)},{trans:i,transless:K.transless||K}):Wt(this.db,e,[this.name],u)}finally{o&&Ge()}},t.prototype.get=function(e,n){var r=this;return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",function(i){return r.core.get({trans:i,key:e}).then(function(a){return r.hook.reading.fire(a)})}).then(n)},t.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(z(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var n=j(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter(function(f){return f.compound&&n.every(function(l){return f.keyPath.indexOf(l)>=0})&&f.keyPath.every(function(l){return n.indexOf(l)>=0})})[0];if(r&&this.db._maxKey!==ge)return this.where(r.name).equals(r.keyPath.map(function(f){return e[f]}));!r&&te&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a "+("compound index ["+n.join("+")+"]"));var i=this.schema.idxByName,a=this.db._deps.indexedDB;function u(f,l){try{return a.cmp(f,l)===0}catch{return!1}}var o=n.reduce(function(f,l){var d=f[0],b=f[1],v=i[l],h=e[l];return[d||v,d||!v?xe(b,v&&v.multi?function(y){var w=ue(y,l);return z(w)&&w.some(function(_){return u(h,_)})}:function(y){return u(h,ue(y,l))}):b]},[null,null]),s=o[0],c=o[1];return s?this.where(s.name).equals(e[s.keyPath]).filter(c):r?this.filter(c):this.where(n).equals("")},t.prototype.filter=function(e){return this.toCollection().and(e)},t.prototype.count=function(e){return this.toCollection().count(e)},t.prototype.offset=function(e){return this.toCollection().offset(e)},t.prototype.limit=function(e){return this.toCollection().limit(e)},t.prototype.each=function(e){return this.toCollection().each(e)},t.prototype.toArray=function(e){return this.toCollection().toArray(e)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,z(e)?"["+e.join("+")+"]":e))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(e){this.schema.mappedClass=e;var n=function(r){if(!r)return r;var i=Object.create(e.prototype);for(var a in r)if(Y(r,a))try{i[a]=r[a]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e},t.prototype.defineClass=function(){function e(n){U(this,n)}return this.mapToClass(e)},t.prototype.add=function(e,n){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=e;return u&&a&&(o=et(u)(e)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"add",keys:n!=null?[n]:null,values:[o]})}).then(function(s){return s.numFailures?A.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{J(e,u,s)}catch{}return s})},t.prototype.update=function(e,n){if(typeof e=="object"&&!z(e)){var r=ue(e,this.schema.primKey.keyPath);if(r===void 0)return L(new C.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?j(n).forEach(function(i){J(e,i,n[i])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}else return this.where(":id").equals(e).modify(n)},t.prototype.put=function(e,n){var r=this,i=this.schema.primKey,a=i.auto,u=i.keyPath,o=e;return u&&a&&(o=et(u)(e)),this._trans("readwrite",function(s){return r.core.mutate({trans:s,type:"put",values:[o],keys:n!=null?[n]:null})}).then(function(s){return s.numFailures?A.reject(s.failures[0]):s.lastResult}).then(function(s){if(u)try{J(e,u,s)}catch{}return s})},t.prototype.delete=function(e){var n=this;return this._trans("readwrite",function(r){return n.core.mutate({trans:r,type:"delete",keys:[e]})}).then(function(r){return r.numFailures?A.reject(r.failures[0]):void 0})},t.prototype.clear=function(){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"deleteRange",range:rr})}).then(function(n){return n.numFailures?A.reject(n.failures[0]):void 0})},t.prototype.bulkGet=function(e){var n=this;return this._trans("readonly",function(r){return n.core.getMany({keys:e,trans:r}).then(function(i){return i.map(function(a){return n.hook.reading.fire(a)})})})},t.prototype.bulkAdd=function(e,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,f=s.keyPath;if(f&&a)throw new C.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new C.InvalidArgument("Arguments objects and keys must have the same length");var l=e.length,d=f&&c?e.map(et(f)):e;return i.core.mutate({trans:o,type:"add",keys:a,values:d,wantResults:u}).then(function(b){var v=b.numFailures,h=b.results,y=b.lastResult,w=b.failures,_=u?h:y;if(v===0)return _;throw new Me(i.name+".bulkAdd(): "+v+" of "+l+" operations failed",w)})})},t.prototype.bulkPut=function(e,n,r){var i=this,a=Array.isArray(n)?n:void 0;r=r||(a?void 0:n);var u=r?r.allKeys:void 0;return this._trans("readwrite",function(o){var s=i.schema.primKey,c=s.auto,f=s.keyPath;if(f&&a)throw new C.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new C.InvalidArgument("Arguments objects and keys must have the same length");var l=e.length,d=f&&c?e.map(et(f)):e;return i.core.mutate({trans:o,type:"put",keys:a,values:d,wantResults:u}).then(function(b){var v=b.numFailures,h=b.results,y=b.lastResult,w=b.failures,_=u?h:y;if(v===0)return _;throw new Me(i.name+".bulkPut(): "+v+" of "+l+" operations failed",w)})})},t.prototype.bulkDelete=function(e){var n=this,r=e.length;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"delete",keys:e})}).then(function(i){var a=i.numFailures,u=i.lastResult,o=i.failures;if(a===0)return u;throw new Me(n.name+".bulkDelete(): "+a+" of "+r+" operations failed",o)})},t}();function qe(t){var e={},n=function(o,s){if(s){for(var c=arguments.length,f=new Array(c-1);--c;)f[c-1]=arguments[c];return e[o].subscribe.apply(null,f),t}else if(typeof o=="string")return e[o]};n.addEventType=a;for(var r=1,i=arguments.length;r<i;++r)a(arguments[r]);return n;function a(o,s,c){if(typeof o=="object")return u(o);s||(s=Rr),c||(c=O);var f={subscribers:[],fire:c,subscribe:function(l){f.subscribers.indexOf(l)===-1&&(f.subscribers.push(l),f.fire=s(f.fire,l))},unsubscribe:function(l){f.subscribers=f.subscribers.filter(function(d){return d!==l}),f.fire=f.subscribers.reduce(s,c)}};return e[o]=n[o]=f,f}function u(o){j(o).forEach(function(s){var c=o[s];if(z(c))a(s,o[s][0],o[s][1]);else if(c==="asap")var f=a(s,Qe,function(){for(var d=arguments.length,b=new Array(d);d--;)b[d]=arguments[d];f.subscribers.forEach(function(v){Fn(function(){v.apply(null,b)})})});else throw new C.InvalidArgument("Invalid event config")})}}function Je(t,e){return ke(e).from({prototype:t}),e}function Xr(t){return Je(Qr.prototype,function(n,r,i){this.db=t,this._tx=i,this.name=n,this.schema=r,this.hook=t._allTables[n]?t._allTables[n].hook:qe(null,{creating:[Dr,O],reading:[kr,Qe],updating:[Pr,O],deleting:[Ir,O]})})}function Ae(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function St(t,e){t.filter=xe(t.filter,e)}function Tt(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return xe(r(),e())}:e,t.justLimit=n&&!r}function Gr(t,e){t.isMatch=xe(t.isMatch,e)}function ct(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new C.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function An(t,e,n){var r=ct(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function tt(t,e,n,r){var i=t.replayFilter?xe(t.filter,t.replayFilter()):t.filter;if(t.or){var a={},u=function(o,s,c){if(!i||i(s,c,function(d){return s.stop(d)},function(d){return s.fail(d)})){var f=s.primaryKey,l=""+f;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(f)),Y(a,l)||(a[l]=!0,e(o,s,c))}};return Promise.all([t.or._iterate(u,n),Kn(An(t,r,n),t.algorithm,u,!t.keysOnly&&t.valueMapper)])}else return Kn(An(t,r,n),xe(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Kn(t,e,n,r){var i=r?function(u,o,s){return n(r(u),o,s)}:n,a=F(i);return t.then(function(u){if(u)return u.start(function(){var o=function(){return u.continue()};(!e||e(u,function(s){return o=s},function(s){u.stop(s),o=O},function(s){u.fail(s),o=O}))&&a(u.value,u,function(s){return o=s}),o()})})}function W(t,e){try{var n=Sn(t),r=Sn(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return Jr(Tn(t),Tn(e));case"Array":return qr(t,e)}}catch{}return NaN}function qr(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,a=0;a<i;++a){var u=W(t[a],e[a]);if(u!==0)return u}return n===r?0:n<r?-1:1}function Jr(t,e){for(var n=t.length,r=e.length,i=n<r?n:r,a=0;a<i;++a)if(t[a]!==e[a])return t[a]<e[a]?-1:1;return n===r?0:n<r?-1:1}function Sn(t){var e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";var n=Pt(t);return n==="ArrayBuffer"?"binary":n}function Tn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}var $r=function(){function t(){}return t.prototype._read=function(e,n){var r=this._ctx;return r.error?r.table._trans(null,L.bind(null,r.error)):r.table._trans("readonly",e).then(n)},t.prototype._write=function(e){var n=this._ctx;return n.error?n.table._trans(null,L.bind(null,n.error)):n.table._trans("readwrite",e,"locked")},t.prototype._addAlgorithm=function(e){var n=this._ctx;n.algorithm=xe(n.algorithm,e)},t.prototype._iterate=function(e,n){return tt(this._ctx,e,n,this._ctx.table.core)},t.prototype.clone=function(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&U(r,e),n._ctx=r,n},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(e){var n=this._ctx;return this._read(function(r){return tt(n,e,r,n.table.core)})},t.prototype.count=function(e){var n=this;return this._read(function(r){var i=n._ctx,a=i.table.core;if(Ae(i,!0))return a.count({trans:r,query:{index:ct(i,a.schema),range:i.range}}).then(function(o){return Math.min(o,i.limit)});var u=0;return tt(i,function(){return++u,!1},r,a).then(function(){return u})}).then(e)},t.prototype.sortBy=function(e,n){var r=e.split(".").reverse(),i=r[0],a=r.length-1;function u(c,f){return f?u(c[r[f]],f-1):c[i]}var o=this._ctx.dir==="next"?1:-1;function s(c,f){var l=u(c,a),d=u(f,a);return l<d?-o:l>d?o:0}return this.toArray(function(c){return c.sort(s)}).then(n)},t.prototype.toArray=function(e){var n=this;return this._read(function(r){var i=n._ctx;if(i.dir==="next"&&Ae(i,!0)&&i.limit>0){var a=i.valueMapper,u=ct(i,i.table.core.schema);return i.table.core.query({trans:r,limit:i.limit,values:!0,query:{index:u,range:i.range}}).then(function(s){var c=s.result;return a?c.map(a):c})}else{var o=[];return tt(i,function(s){return o.push(s)},r,i.table.core).then(function(){return o})}},e)},t.prototype.offset=function(e){var n=this._ctx;return e<=0?this:(n.offset+=e,Ae(n)?Tt(n,function(){var r=e;return function(i,a){return r===0?!0:r===1?(--r,!1):(a(function(){i.advance(r),r=0}),!1)}}):Tt(n,function(){var r=e;return function(){return--r<0}}),this)},t.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Tt(this._ctx,function(){var n=e;return function(r,i,a){return--n<=0&&i(a),n>=0}},!0),this},t.prototype.until=function(e,n){return St(this._ctx,function(r,i,a){return e(r.value)?(i(a),n):!0}),this},t.prototype.first=function(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)},t.prototype.last=function(e){return this.reverse().first(e)},t.prototype.filter=function(e){return St(this._ctx,function(n){return e(n.value)}),Gr(this._ctx,e),this},t.prototype.and=function(e){return this.filter(e)},t.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},t.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.key,i)})},t.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},t.prototype.eachPrimaryKey=function(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,i){e(i.primaryKey,i)})},t.prototype.keys=function(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.key)}).then(function(){return r}).then(e)},t.prototype.primaryKeys=function(e){var n=this._ctx;if(n.dir==="next"&&Ae(n,!0)&&n.limit>0)return this._read(function(i){var a=ct(n,n.table.core.schema);return n.table.core.query({trans:i,values:!1,limit:n.limit,query:{index:a,range:n.range}})}).then(function(i){var a=i.result;return a}).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(i,a){r.push(a.primaryKey)}).then(function(){return r}).then(e)},t.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},t.prototype.firstKey=function(e){return this.limit(1).keys(function(n){return n[0]}).then(e)},t.prototype.lastKey=function(e){return this.reverse().firstKey(e)},t.prototype.distinct=function(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return St(this._ctx,function(i){var a=i.primaryKey.toString(),u=Y(r,a);return r[a]=!0,!u}),this},t.prototype.modify=function(e){var n=this,r=this._ctx;return this._write(function(i){var a;if(typeof e=="function")a=e;else{var u=j(e),o=u.length;a=function(w){for(var _=!1,m=0;m<o;++m){var g=u[m],p=e[g];ue(w,g)!==p&&(J(w,g,p),_=!0)}return _}}var s=r.table.core,c=s.schema.primaryKey,f=c.outbound,l=c.extractKey,d=n.db._options.modifyChunkSize||200,b=[],v=0,h=[],y=function(w,_){var m=_.failures,g=_.numFailures;v+=w-g;for(var p=0,x=j(m);p<x.length;p++){var S=x[p];b.push(m[S])}};return n.clone().primaryKeys().then(function(w){var _=function(m){var g=Math.min(d,w.length-m);return s.getMany({trans:i,keys:w.slice(m,m+g),cache:"immutable"}).then(function(p){for(var x=[],S=[],E=f?[]:null,T=[],k=0;k<g;++k){var R=p[k],B={value:Ye(R),primKey:w[m+k]};a.call(B,B.value,B)!==!1&&(B.value==null?T.push(w[m+k]):!f&&W(l(R),l(B.value))!==0?(T.push(w[m+k]),x.push(B.value)):(S.push(B.value),f&&E.push(w[m+k])))}var P=Ae(r)&&r.limit===1/0&&(typeof e!="function"||e===Ct)&&{index:r.index,range:r.range};return Promise.resolve(x.length>0&&s.mutate({trans:i,type:"add",values:x}).then(function(N){for(var D in N.failures)T.splice(parseInt(D),1);y(x.length,N)})).then(function(){return(S.length>0||P&&typeof e=="object")&&s.mutate({trans:i,type:"put",keys:E,values:S,criteria:P,changeSpec:typeof e!="function"&&e}).then(function(N){return y(S.length,N)})}).then(function(){return(T.length>0||P&&e===Ct)&&s.mutate({trans:i,type:"delete",keys:T,criteria:P}).then(function(N){return y(T.length,N)})}).then(function(){return w.length>m+g&&_(m+d)})})};return _(0).then(function(){if(b.length>0)throw new lt("Error modifying one or more objects",b,v,h);return w.length})})})},t.prototype.delete=function(){var e=this._ctx,n=e.range;return Ae(e)&&(e.isPrimKey&&!Yr||n.type===3)?this._write(function(r){var i=e.table.core.schema.primaryKey,a=n;return e.table.core.count({trans:r,query:{index:i,range:a}}).then(function(u){return e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then(function(o){var s=o.failures;o.lastResult,o.results;var c=o.numFailures;if(c)throw new lt("Could not delete some values",Object.keys(s).map(function(f){return s[f]}),u-c);return u-c})})}):this.modify(Ct)},t}(),Ct=function(t,e){return e.value=null};function Zr(t){return Je($r.prototype,function(n,r){this.db=t;var i=rr,a=null;if(r)try{i=r()}catch(c){a=c}var u=n._ctx,o=u.table,s=o.hook.reading.fire;this._ctx={table:o,index:u.index,isPrimKey:!u.index||o.schema.primKey.keyPath&&u.index===o.schema.primKey.name,range:i,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:a,or:u.or,valueMapper:s!==Qe?s:null}})}function ei(t,e){return t<e?-1:t===e?0:1}function ti(t,e){return t>e?-1:t===e?0:1}function H(t,e,n){var r=t instanceof ar?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Ke(t){return new t.Collection(t,function(){return ir("")}).limit(0)}function ni(t){return t==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function ri(t){return t==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function ii(t,e,n,r,i,a){for(var u=Math.min(t.length,r.length),o=-1,s=0;s<u;++s){var c=e[s];if(c!==r[s])return i(t[s],n[s])<0?t.substr(0,s)+n[s]+n.substr(s+1):i(t[s],r[s])<0?t.substr(0,s)+r[s]+n.substr(s+1):o>=0?t.substr(0,o)+e[o]+n.substr(o+1):null;i(t[s],c)<0&&(o=s)}return u<r.length&&a==="next"?t+n.substr(t.length):u<t.length&&a==="prev"?t.substr(0,n.length):o<0?null:t.substr(0,o)+r[o]+n.substr(o+1)}function nt(t,e,n,r){var i,a,u,o,s,c,f,l=n.length;if(!n.every(function(h){return typeof h=="string"}))return H(t,tr);function d(h){i=ni(h),a=ri(h),u=h==="next"?ei:ti;var y=n.map(function(w){return{lower:a(w),upper:i(w)}}).sort(function(w,_){return u(w.lower,_.lower)});o=y.map(function(w){return w.upper}),s=y.map(function(w){return w.lower}),c=h,f=h==="next"?"":r}d("next");var b=new t.Collection(t,function(){return fe(o[0],s[l-1]+r)});b._ondirectionchange=function(h){d(h)};var v=0;return b._addAlgorithm(function(h,y,w){var _=h.key;if(typeof _!="string")return!1;var m=a(_);if(e(m,s,v))return!0;for(var g=null,p=v;p<l;++p){var x=ii(_,m,o[p],s[p],u,c);x===null&&g===null?v=p+1:(g===null||u(g,x)>0)&&(g=x)}return y(g!==null?function(){h.continue(g+f)}:w),!1}),b}function fe(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function ir(t){return{type:1,lower:t,upper:t}}var ar=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),t.prototype.between=function(e,n,r,i){r=r!==!1,i=i===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||i)&&!(r&&i)?Ke(this):new this.Collection(this,function(){return fe(e,n,!r,!i)})}catch{return H(this,ne)}},t.prototype.equals=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return ir(e)})},t.prototype.above=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return fe(e,void 0,!0)})},t.prototype.aboveOrEqual=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return fe(e,void 0,!1)})},t.prototype.below=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return fe(void 0,e,!1,!0)})},t.prototype.belowOrEqual=function(e){return e==null?H(this,ne):new this.Collection(this,function(){return fe(void 0,e)})},t.prototype.startsWith=function(e){return typeof e!="string"?H(this,tr):this.between(e,e+ge,!0,!0)},t.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):nt(this,function(n,r){return n.indexOf(r[0])===0},[e],ge)},t.prototype.equalsIgnoreCase=function(e){return nt(this,function(n,r){return n===r[0]},[e],"")},t.prototype.anyOfIgnoreCase=function(){var e=ie.apply(Se,arguments);return e.length===0?Ke(this):nt(this,function(n,r){return r.indexOf(n)!==-1},e,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var e=ie.apply(Se,arguments);return e.length===0?Ke(this):nt(this,function(n,r){return r.some(function(i){return n.indexOf(i)===0})},e,ge)},t.prototype.anyOf=function(){var e=this,n=ie.apply(Se,arguments),r=this._cmp;try{n.sort(r)}catch{return H(this,ne)}if(n.length===0)return Ke(this);var i=new this.Collection(this,function(){return fe(n[0],n[n.length-1])});i._ondirectionchange=function(u){r=u==="next"?e._ascending:e._descending,n.sort(r)};var a=0;return i._addAlgorithm(function(u,o,s){for(var c=u.key;r(c,n[a])>0;)if(++a,a===n.length)return o(s),!1;return r(c,n[a])===0?!0:(o(function(){u.continue(n[a])}),!1)}),i},t.prototype.notEqual=function(e){return this.inAnyRange([[Ut,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var e=ie.apply(Se,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return H(this,ne)}var n=e.reduce(function(r,i){return r?r.concat([[r[r.length-1][1],i]]):[[Ut,i]]},null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(e,n){var r=this,i=this._cmp,a=this._ascending,u=this._descending,o=this._min,s=this._max;if(e.length===0)return Ke(this);if(!e.every(function(p){return p[0]!==void 0&&p[1]!==void 0&&a(p[0],p[1])<=0}))return H(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",C.InvalidArgument);var c=!n||n.includeLowers!==!1,f=n&&n.includeUppers===!0;function l(p,x){for(var S=0,E=p.length;S<E;++S){var T=p[S];if(i(x[0],T[1])<0&&i(x[1],T[0])>0){T[0]=o(T[0],x[0]),T[1]=s(T[1],x[1]);break}}return S===E&&p.push(x),p}var d=a;function b(p,x){return d(p[0],x[0])}var v;try{v=e.reduce(l,[]),v.sort(b)}catch{return H(this,ne)}var h=0,y=f?function(p){return a(p,v[h][1])>0}:function(p){return a(p,v[h][1])>=0},w=c?function(p){return u(p,v[h][0])>0}:function(p){return u(p,v[h][0])>=0};function _(p){return!y(p)&&!w(p)}var m=y,g=new this.Collection(this,function(){return fe(v[0][0],v[v.length-1][1],!c,!f)});return g._ondirectionchange=function(p){p==="next"?(m=y,d=a):(m=w,d=u),v.sort(b)},g._addAlgorithm(function(p,x,S){for(var E=p.key;m(E);)if(++h,h===v.length)return x(S),!1;return _(E)?!0:(r._cmp(E,v[h][1])===0||r._cmp(E,v[h][0])===0||x(function(){d===a?p.continue(v[h][0]):p.continue(v[h][1])}),!1)}),g},t.prototype.startsWithAnyOf=function(){var e=ie.apply(Se,arguments);return e.every(function(n){return typeof n=="string"})?e.length===0?Ke(this):this.inAnyRange(e.map(function(n){return[n,n+ge]})):H(this,"startsWithAnyOf() only works with strings")},t}();function ai(t){return Je(ar.prototype,function(n,r,i){this.db=t,this._ctx={table:n,index:r===":id"?null:r,or:i};var a=t._deps.indexedDB;if(!a)throw new C.MissingAPI;this._cmp=this._ascending=a.cmp.bind(a),this._descending=function(u,o){return a.cmp(o,u)},this._max=function(u,o){return a.cmp(u,o)>0?u:o},this._min=function(u,o){return a.cmp(u,o)<0?u:o},this._IDBKeyRange=t._deps.IDBKeyRange})}function ee(t){return F(function(e){return ze(e),t(e.target.error),!1})}function ze(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var We="storagemutated",de="x-storagemutated-1",ye=qe(null,We),ui=function(){function t(){}return t.prototype._lock=function(){return Be(!K.global),++this._reculock,this._reculock===1&&!K.global&&(K.lockOwnerFor=this),this},t.prototype._unlock=function(){if(Be(!K.global),--this._reculock===0)for(K.global||(K.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Pe(e[1],e[0])}catch{}}return this},t.prototype._locked=function(){return this._reculock&&K.lockOwnerFor!==this},t.prototype.create=function(e){var n=this;if(!this.mode)return this;var r=this.db.idbdb,i=this.db._state.dbOpenError;if(Be(!this.idbtrans),!e&&!r)switch(i&&i.name){case"DatabaseClosedError":throw new C.DatabaseClosed(i);case"MissingAPIError":throw new C.MissingAPI(i.message,i);default:throw new C.OpenFailed(i)}if(!this.active)throw new C.TransactionInactive;return Be(this._completion._state===null),e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):r.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})),e.onerror=F(function(a){ze(a),n._reject(e.error)}),e.onabort=F(function(a){ze(a),n.active&&n._reject(new C.Abort(e.error)),n.active=!1,n.on("abort").fire(a)}),e.oncomplete=F(function(){n.active=!1,n._resolve(),"mutatedParts"in e&&ye.storagemutated.fire(e.mutatedParts)}),this},t.prototype._promise=function(e,n,r){var i=this;if(e==="readwrite"&&this.mode!=="readwrite")return L(new C.ReadOnly("Transaction is readonly"));if(!this.active)return L(new C.TransactionInactive);if(this._locked())return new A(function(u,o){i._blockedFuncs.push([function(){i._promise(e,n,r).then(u,o)},K])});if(r)return ve(function(){var u=new A(function(o,s){i._lock();var c=n(o,s,i);c&&c.then&&c.then(o,s)});return u.finally(function(){return i._unlock()}),u._lib=!0,u});var a=new A(function(u,o){var s=n(u,o,i);s&&s.then&&s.then(u,o)});return a._lib=!0,a},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(e){var n=this._root(),r=A.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(function(){return r});else{n._waitingFor=r,n._waitingQueue=[];var i=n.idbtrans.objectStore(n.storeNames[0]);(function u(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(i.get(-1/0).onsuccess=u)})()}var a=n._waitingFor;return new A(function(u,o){r.then(function(s){return n._waitingQueue.push(F(u.bind(null,s)))},function(s){return n._waitingQueue.push(F(o.bind(null,s)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new C.Abort))},t.prototype.table=function(e){var n=this._memoizedTables||(this._memoizedTables={});if(Y(n,e))return n[e];var r=this.schema[e];if(!r)throw new C.NotFound("Table "+e+" not part of transaction");var i=new this.db.Table(e,r,this);return i.core=this.db.core.table(e),n[e]=i,i},t}();function oi(t){return Je(ui.prototype,function(n,r,i,a,u){var o=this;this.db=t,this.mode=n,this.storeNames=r,this.schema=i,this.chromeTransactionDurability=a,this.idbtrans=null,this.on=qe(this,"complete","error","abort"),this.parent=u||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new A(function(s,c){o._resolve=s,o._reject=c}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(s){var c=o.active;return o.active=!1,o.on.error.fire(s),o.parent?o.parent._reject(s):c&&o.idbtrans&&o.idbtrans.abort(),L(s)})})}function Ht(t,e,n,r,i,a,u){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:a,src:(n&&!u?"&":"")+(r?"*":"")+(i?"++":"")+ur(e)}}function ur(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function or(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:jn(n,function(r){return[r.name,r]})}}function si(t){return t.length===1?t[0]:t}var Ue=function(t){try{return t.only([[]]),Ue=function(){return[[]]},[[]]}catch{return Ue=function(){return ge},ge}};function Yt(t){return t==null?function(){}:typeof t=="string"?ci(t):function(e){return ue(e,t)}}function ci(t){var e=t.split(".");return e.length===1?function(n){return n[t]}:function(n){return ue(n,t)}}function Cn(t){return[].slice.call(t)}var li=0;function je(t){return t==null?":id":typeof t=="string"?t:"["+t.join("+")+"]"}function fi(t,e,n){function r(l,d){var b=Cn(l.objectStoreNames);return{schema:{name:l.name,tables:b.map(function(v){return d.objectStore(v)}).map(function(v){var h=v.keyPath,y=v.autoIncrement,w=z(h),_=h==null,m={},g={name:v.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:_,compound:w,keyPath:h,autoIncrement:y,unique:!0,extractKey:Yt(h)},indexes:Cn(v.indexNames).map(function(p){return v.index(p)}).map(function(p){var x=p.name,S=p.unique,E=p.multiEntry,T=p.keyPath,k=z(T),R={name:x,compound:k,keyPath:T,unique:S,multiEntry:E,extractKey:Yt(T)};return m[je(T)]=R,R}),getIndexByKeyPath:function(p){return m[je(p)]}};return m[":id"]=g.primaryKey,h!=null&&(m[je(h)]=g.primaryKey),g})},hasGetAll:b.length>0&&"getAll"in d.objectStore(b[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function i(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var d=l.lower,b=l.upper,v=l.lowerOpen,h=l.upperOpen,y=d===void 0?b===void 0?null:e.upperBound(b,!!h):b===void 0?e.lowerBound(d,!!v):e.bound(d,b,!!v,!!h);return y}function a(l){var d=l.name;function b(y){var w=y.trans,_=y.type,m=y.keys,g=y.values,p=y.range;return new Promise(function(x,S){x=F(x);var E=w.objectStore(d),T=E.keyPath==null,k=_==="put"||_==="add";if(!k&&_!=="delete"&&_!=="deleteRange")throw new Error("Invalid operation type: "+_);var R=(m||g||{length:1}).length;if(m&&g&&m.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(R===0)return x({numFailures:0,failures:{},results:[],lastResult:void 0});var B,P=[],N=[],D=0,Q=function(Z){++D,ze(Z)};if(_==="deleteRange"){if(p.type===4)return x({numFailures:D,failures:N,results:[],lastResult:void 0});p.type===3?P.push(B=E.clear()):P.push(B=E.delete(i(p)))}else{var G=k?T?[g,m]:[g,null]:[m,null],ce=G[0],$=G[1];if(k)for(var X=0;X<R;++X)P.push(B=$&&$[X]!==void 0?E[_](ce[X],$[X]):E[_](ce[X])),B.onerror=Q;else for(var X=0;X<R;++X)P.push(B=E[_](ce[X])),B.onerror=Q}var le=function(Z){var Re=Z.target.result;P.forEach(function(q,$e){return q.error!=null&&(N[$e]=q.error)}),x({numFailures:D,failures:N,results:_==="delete"?m:P.map(function(q){return q.result}),lastResult:Re})};B.onerror=function(Z){Q(Z),le(Z)},B.onsuccess=le})}function v(y){var w=y.trans,_=y.values,m=y.query,g=y.reverse,p=y.unique;return new Promise(function(x,S){x=F(x);var E=m.index,T=m.range,k=w.objectStore(d),R=E.isPrimaryKey?k:k.index(E.name),B=g?p?"prevunique":"prev":p?"nextunique":"next",P=_||!("openKeyCursor"in R)?R.openCursor(i(T),B):R.openKeyCursor(i(T),B);P.onerror=ee(S),P.onsuccess=F(function(N){var D=P.result;if(!D){x(null);return}D.___id=++li,D.done=!1;var Q=D.continue.bind(D),G=D.continuePrimaryKey;G&&(G=G.bind(D));var ce=D.advance.bind(D),$=function(){throw new Error("Cursor not started")},X=function(){throw new Error("Cursor not stopped")};D.trans=w,D.stop=D.continue=D.continuePrimaryKey=D.advance=$,D.fail=F(S),D.next=function(){var le=this,Z=1;return this.start(function(){return Z--?le.continue():le.stop()}).then(function(){return le})},D.start=function(le){var Z=new Promise(function(q,$e){q=F(q),P.onerror=ee($e),D.fail=$e,D.stop=function(vr){D.stop=D.continue=D.continuePrimaryKey=D.advance=X,q(vr)}}),Re=function(){if(P.result)try{le()}catch(q){D.fail(q)}else D.done=!0,D.start=function(){throw new Error("Cursor behind last entry")},D.stop()};return P.onsuccess=F(function(q){P.onsuccess=Re,Re()}),D.continue=Q,D.continuePrimaryKey=G,D.advance=ce,Re(),Z},x(D)},S)})}function h(y){return function(w){return new Promise(function(_,m){_=F(_);var g=w.trans,p=w.values,x=w.limit,S=w.query,E=x===1/0?void 0:x,T=S.index,k=S.range,R=g.objectStore(d),B=T.isPrimaryKey?R:R.index(T.name),P=i(k);if(x===0)return _({result:[]});if(y){var N=p?B.getAll(P,E):B.getAllKeys(P,E);N.onsuccess=function(ce){return _({result:ce.target.result})},N.onerror=ee(m)}else{var D=0,Q=p||!("openKeyCursor"in B)?B.openCursor(P):B.openKeyCursor(P),G=[];Q.onsuccess=function(ce){var $=Q.result;if(!$)return _({result:G});if(G.push(p?$.value:$.primaryKey),++D===x)return _({result:G});$.continue()},Q.onerror=ee(m)}})}}return{name:d,schema:l,mutate:b,getMany:function(y){var w=y.trans,_=y.keys;return new Promise(function(m,g){m=F(m);for(var p=w.objectStore(d),x=_.length,S=new Array(x),E=0,T=0,k,R=function(D){var Q=D.target;(S[Q._pos]=Q.result)!=null,++T===E&&m(S)},B=ee(g),P=0;P<x;++P){var N=_[P];N!=null&&(k=p.get(_[P]),k._pos=P,k.onsuccess=R,k.onerror=B,++E)}E===0&&m(S)})},get:function(y){var w=y.trans,_=y.key;return new Promise(function(m,g){m=F(m);var p=w.objectStore(d),x=p.get(_);x.onsuccess=function(S){return m(S.target.result)},x.onerror=ee(g)})},query:h(s),openCursor:v,count:function(y){var w=y.query,_=y.trans,m=w.index,g=w.range;return new Promise(function(p,x){var S=_.objectStore(d),E=m.isPrimaryKey?S:S.index(m.name),T=i(g),k=T?E.count(T):E.count();k.onsuccess=F(function(R){return p(R.target.result)}),k.onerror=ee(x)})}}}var u=r(t,n),o=u.schema,s=u.hasGetAll,c=o.tables.map(function(l){return a(l)}),f={};return c.forEach(function(l){return f[l.name]=l}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(l){var d=f[l];if(!d)throw new Error("Table '"+l+"' not found");return f[l]},MIN_KEY:-1/0,MAX_KEY:Ue(e),schema:o}}function hi(t,e){return e.reduce(function(n,r){var i=r.create;return I(I({},n),i(n))},t)}function di(t,e,n,r){var i=n.IDBKeyRange;n.indexedDB;var a=hi(fi(e,i,r),t.dbcore);return{dbcore:a}}function ln(t,e){var n=t._novip,r=e.db,i=di(n._middlewares,r,n._deps,e);n.core=i.dbcore,n.tables.forEach(function(a){var u=a.name;n.core.schema.tables.some(function(o){return o.name===u})&&(a.core=n.core.table(u),n[u]instanceof n.Table&&(n[u].core=a.core))})}function yt(t,e,n,r){var i=t._novip;n.forEach(function(a){var u=r[a];e.forEach(function(o){var s=en(o,a);(!s||"value"in s&&s.value===void 0)&&(o===i.Transaction.prototype||o instanceof i.Transaction?oe(o,a,{get:function(){return this.table(a)},set:function(c){On(this,a,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[a]=new i.Table(a,u))})})}function Qt(t,e){var n=t._novip;e.forEach(function(r){for(var i in r)r[i]instanceof n.Table&&delete r[i]})}function vi(t,e){return t._cfg.version-e._cfg.version}function pi(t,e,n,r){var i=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,i);a.create(n),a._completion.catch(r);var u=a._reject.bind(a),o=K.transless||K;ve(function(){K.trans=a,K.transless=o,e===0?(j(i).forEach(function(s){fn(n,s,i[s].primKey,i[s].indexes)}),ln(t,n),A.follow(function(){return t.on.populate.fire(a)}).catch(u)):yi(t,e,a,n).catch(u)})}function yi(t,e,n,r){var i=t._novip,a=[],u=i._versions,o=i._dbSchema=hn(i,i.idbdb,r),s=!1,c=u.filter(function(l){return l._cfg.version>=e});c.forEach(function(l){a.push(function(){var d=o,b=l._cfg.dbschema;Gt(i,d,r),Gt(i,b,r),o=i._dbSchema=b;var v=sr(d,b);v.add.forEach(function(g){fn(r,g[0],g[1].primKey,g[1].indexes)}),v.change.forEach(function(g){if(g.recreate)throw new C.Upgrade("Not yet support for changing primary key");var p=r.objectStore(g.name);g.add.forEach(function(x){return Xt(p,x)}),g.change.forEach(function(x){p.deleteIndex(x.name),Xt(p,x)}),g.del.forEach(function(x){return p.deleteIndex(x)})});var h=l._cfg.contentUpgrade;if(h&&l._cfg.version>e){ln(i,r),n._memoizedTables={},s=!0;var y=Ln(b);v.del.forEach(function(g){y[g]=d[g]}),Qt(i,[i.Transaction.prototype]),yt(i,[i.Transaction.prototype],j(y),y),n.schema=y;var w=tn(h);w&&Ie();var _,m=A.follow(function(){if(_=h(n),_&&w){var g=se.bind(null,null);_.then(g,g)}});return _&&typeof _.then=="function"?A.resolve(_):m.then(function(){return _})}}),a.push(function(d){if(!s||!Hr){var b=l._cfg.dbschema;gi(b,d)}Qt(i,[i.Transaction.prototype]),yt(i,[i.Transaction.prototype],i._storeNames,i._dbSchema),n.schema=i._dbSchema})});function f(){return a.length?A.resolve(a.shift()(n.idbtrans)).then(f):A.resolve()}return f().then(function(){mi(o,r)})}function sr(t,e){var n={del:[],add:[],change:[]},r;for(r in t)e[r]||n.del.push(r);for(r in e){var i=t[r],a=e[r];if(!i)n.add.push([r,a]);else{var u={name:r,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||i.primKey.auto!==a.primKey.auto&&!_t)u.recreate=!0,n.change.push(u);else{var o=i.idxByName,s=a.idxByName,c=void 0;for(c in o)s[c]||u.del.push(c);for(c in s){var f=o[c],l=s[c];f?f.src!==l.src&&u.change.push(l):u.add.push(l)}(u.del.length>0||u.add.length>0||u.change.length>0)&&n.change.push(u)}}}return n}function fn(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(a){return Xt(i,a)}),i}function mi(t,e){j(t).forEach(function(n){e.db.objectStoreNames.contains(n)||fn(e,n,t[n].primKey,t[n].indexes)})}function gi(t,e){[].slice.call(e.db.objectStoreNames).forEach(function(n){return t[n]==null&&e.db.deleteObjectStore(n)})}function Xt(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function hn(t,e,n){var r={},i=bt(e.objectStoreNames,0);return i.forEach(function(a){for(var u=n.objectStore(a),o=u.keyPath,s=Ht(ur(o),o||"",!1,!1,!!u.autoIncrement,o&&typeof o!="string",!0),c=[],f=0;f<u.indexNames.length;++f){var l=u.index(u.indexNames[f]);o=l.keyPath;var d=Ht(l.name,o,!!l.unique,!!l.multiEntry,!1,o&&typeof o!="string",!1);c.push(d)}r[a]=or(a,s,c)}),r}function bi(t,e,n){var r=t._novip;r.verno=e.version/10;var i=r._dbSchema=hn(r,e,n);r._storeNames=bt(e.objectStoreNames,0),yt(r,[r._allTables],j(i),i)}function wi(t,e){var n=hn(t,t.idbdb,e),r=sr(n,t._dbSchema);return!(r.add.length||r.change.some(function(i){return i.add.length||i.change.length}))}function Gt(t,e,n){for(var r=t._novip,i=n.db.objectStoreNames,a=0;a<i.length;++a){var u=i[a],o=n.objectStore(u);r._hasGetAll="getAll"in o;for(var s=0;s<o.indexNames.length;++s){var c=o.indexNames[s],f=o.index(c).keyPath,l=typeof f=="string"?f:"["+bt(f).join("+")+"]";if(e[u]){var d=e[u].idxByName[l];d&&(d.name=c,delete e[u].idxByName[l],e[u].idxByName[c]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&M.WorkerGlobalScope&&M instanceof M.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}function _i(t){return t.split(",").map(function(e,n){e=e.trim();var r=e.replace(/([&*]|\+\+)/g,""),i=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Ht(r,i||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),z(i),n===0)})}var xi=function(){function t(){}return t.prototype._parseStoresSpec=function(e,n){j(e).forEach(function(r){if(e[r]!==null){var i=_i(e[r]),a=i.shift();if(a.multi)throw new C.Schema("Primary key cannot be multi-valued");i.forEach(function(u){if(u.auto)throw new C.Schema("Only primary key can be marked as autoIncrement (++)");if(!u.keyPath)throw new C.Schema("Index must have a name and cannot be an empty string")}),n[r]=or(r,a,i)}})},t.prototype.stores=function(e){var n=this.db;this._cfg.storesSource=this._cfg.storesSource?U(this._cfg.storesSource,e):e;var r=n._versions,i={},a={};return r.forEach(function(u){U(i,u._cfg.storesSource),a=u._cfg.dbschema={},u._parseStoresSpec(i,a)}),n._dbSchema=a,Qt(n,[n._allTables,n,n.Transaction.prototype]),yt(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],j(a),a),n._storeNames=j(a),this},t.prototype.upgrade=function(e){return this._cfg.contentUpgrade=an(this._cfg.contentUpgrade||O,e),this},t}();function Ei(t){return Je(xi.prototype,function(n){this.db=t,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function dn(t,e){var n=t._dbNamesDB;return n||(n=t._dbNamesDB=new mn(xt,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function vn(t){return t&&typeof t.databases=="function"}function Ai(t){var e=t.indexedDB,n=t.IDBKeyRange;return vn(e)?Promise.resolve(e.databases()).then(function(r){return r.map(function(i){return i.name}).filter(function(i){return i!==xt})}):dn(e,n).toCollection().primaryKeys()}function Ki(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!vn(n)&&e!==xt&&dn(n,r).put({name:e}).catch(O)}function Si(t,e){var n=t.indexedDB,r=t.IDBKeyRange;!vn(n)&&e!==xt&&dn(n,r).delete(e).catch(O)}function qt(t){return ve(function(){return K.letThrough=!0,t()})}function Ti(){var t=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!t||!indexedDB.databases)return Promise.resolve();var e;return new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};e=setInterval(r,100),r()}).finally(function(){return clearInterval(e)})}function Ci(t){var e=t._state,n=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?L(e.dbOpenError):t});te&&(e.openCanceller._stackHolder=Ee()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var r=e.openCanceller;function i(){if(e.openCanceller!==r)throw new C.DatabaseClosed("db.open() was cancelled")}var a=e.dbReadyResolve,u=null,o=!1;return A.race([r,(typeof navigator>"u"?A.resolve():Ti()).then(function(){return new A(function(s,c){if(i(),!n)throw new C.MissingAPI;var f=t.name,l=e.autoSchema?n.open(f):n.open(f,Math.round(t.verno*10));if(!l)throw new C.MissingAPI;l.onerror=ee(c),l.onblocked=F(t._fireOnBlocked),l.onupgradeneeded=F(function(d){if(u=l.transaction,e.autoSchema&&!t._options.allowEmptyDB){l.onerror=ze,u.abort(),l.result.close();var b=n.deleteDatabase(f);b.onsuccess=b.onerror=F(function(){c(new C.NoSuchDatabase("Database "+f+" doesnt exist"))})}else{u.onerror=ee(c);var v=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;o=v<1,t._novip.idbdb=l.result,pi(t,v/10,u,c)}},c),l.onsuccess=F(function(){u=null;var d=t._novip.idbdb=l.result,b=bt(d.objectStoreNames);if(b.length>0)try{var v=d.transaction(si(b),"readonly");e.autoSchema?bi(t,d,v):(Gt(t,t._dbSchema,v),wi(t,v)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),ln(t,v)}catch{}Fe.push(t),d.onversionchange=F(function(h){e.vcFired=!0,t.on("versionchange").fire(h)}),d.onclose=F(function(h){t.on("close").fire(h)}),o&&Ki(t._deps,f),s()},c)})})]).then(function(){return i(),e.onReadyBeingFired=[],A.resolve(qt(function(){return t.on.ready.fire(t.vip)})).then(function s(){if(e.onReadyBeingFired.length>0){var c=e.onReadyBeingFired.reduce(an,O);return e.onReadyBeingFired=[],A.resolve(qt(function(){return c(t.vip)})).then(s)}})}).finally(function(){e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(function(){return t}).catch(function(s){e.dbOpenError=s;try{u&&u.abort()}catch{}return r===e.openCanceller&&t._close(),L(s)}).finally(function(){e.openComplete=!0,a()})}function Jt(t){var e=function(u){return t.next(u)},n=function(u){return t.throw(u)},r=a(e),i=a(n);function a(u){return function(o){var s=u(o),c=s.value;return s.done?c:!c||typeof c.then!="function"?z(c)?Promise.all(c).then(r,i):r(c):c.then(r,i)}}return a(e)()}function ki(t,e,n){var r=arguments.length;if(r<2)throw new C.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];n=i.pop();var a=Nn(i);return[t,a,n]}function cr(t,e,n,r,i){return A.resolve().then(function(){var a=K.transless||K,u=t._createTransaction(e,n,t._dbSchema,r),o={trans:u,transless:a};if(r)u.idbtrans=r.idbtrans;else try{u.create(),t._state.PR1398_maxLoop=3}catch(l){return l.name===rn.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(function(){return cr(t,e,n,null,i)})):L(l)}var s=tn(i);s&&Ie();var c,f=A.follow(function(){if(c=i.call(u,u),c)if(s){var l=se.bind(null,null);c.then(l,l)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=Jt(c))},o);return(c&&typeof c.then=="function"?A.resolve(c).then(function(l){return u.active?l:L(new C.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):f.then(function(){return c})).then(function(l){return r&&u._resolve(),u._completion.then(function(){return l})}).catch(function(l){return u._reject(l),L(l)})})}function rt(t,e,n){for(var r=z(t)?t.slice():[t],i=0;i<n;++i)r.push(e);return r}function Di(t){return I(I({},t),{table:function(e){var n=t.table(e),r=n.schema,i={},a=[];function u(h,y,w){var _=je(h),m=i[_]=i[_]||[],g=h==null?0:typeof h=="string"?1:h.length,p=y>0,x=I(I({},w),{isVirtual:p,keyTail:y,keyLength:g,extractKey:Yt(h),unique:!p&&w.unique});if(m.push(x),x.isPrimaryKey||a.push(x),g>1){var S=g===2?h[0]:h.slice(0,g-1);u(S,y+1,w)}return m.sort(function(E,T){return E.keyTail-T.keyTail}),x}var o=u(r.primaryKey.keyPath,0,r.primaryKey);i[":id"]=[o];for(var s=0,c=r.indexes;s<c.length;s++){var f=c[s];u(f.keyPath,0,f)}function l(h){var y=i[je(h)];return y&&y[0]}function d(h,y){return{type:h.type===1?2:h.type,lower:rt(h.lower,h.lowerOpen?t.MAX_KEY:t.MIN_KEY,y),lowerOpen:!0,upper:rt(h.upper,h.upperOpen?t.MIN_KEY:t.MAX_KEY,y),upperOpen:!0}}function b(h){var y=h.query.index;return y.isVirtual?I(I({},h),{query:{index:y,range:d(h.query.range,y.keyTail)}}):h}var v=I(I({},n),{schema:I(I({},r),{primaryKey:o,indexes:a,getIndexByKeyPath:l}),count:function(h){return n.count(b(h))},query:function(h){return n.query(b(h))},openCursor:function(h){var y=h.query.index,w=y.keyTail,_=y.isVirtual,m=y.keyLength;if(!_)return n.openCursor(h);function g(p){function x(E){E!=null?p.continue(rt(E,h.reverse?t.MAX_KEY:t.MIN_KEY,w)):h.unique?p.continue(p.key.slice(0,m).concat(h.reverse?t.MIN_KEY:t.MAX_KEY,w)):p.continue()}var S=Object.create(p,{continue:{value:x},continuePrimaryKey:{value:function(E,T){p.continuePrimaryKey(rt(E,t.MAX_KEY,w),T)}},primaryKey:{get:function(){return p.primaryKey}},key:{get:function(){var E=p.key;return m===1?E[0]:E.slice(0,m)}},value:{get:function(){return p.value}}});return S}return n.openCursor(b(h)).then(function(p){return p&&g(p)})}});return v}})}var Ii={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:Di};function pn(t,e,n,r){return n=n||{},r=r||"",j(t).forEach(function(i){if(!Y(e,i))n[r+i]=void 0;else{var a=t[i],u=e[i];if(typeof a=="object"&&typeof u=="object"&&a&&u){var o=Pt(a),s=Pt(u);o!==s?n[r+i]=e[i]:o==="Object"?pn(a,u,n,r+i+"."):a!==u&&(n[r+i]=e[i])}else a!==u&&(n[r+i]=e[i])}}),j(e).forEach(function(i){Y(t,i)||(n[r+i]=e[i])}),n}function Pi(t,e){return e.type==="delete"?e.keys:e.keys||e.values.map(t.extractKey)}var Ri={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(t){return I(I({},t),{table:function(e){var n=t.table(e),r=n.schema.primaryKey,i=I(I({},n),{mutate:function(a){var u=K.trans,o=u.table(e).hook,s=o.deleting,c=o.creating,f=o.updating;switch(a.type){case"add":if(c.fire===O)break;return u._promise("readwrite",function(){return l(a)},!0);case"put":if(c.fire===O&&f.fire===O)break;return u._promise("readwrite",function(){return l(a)},!0);case"delete":if(s.fire===O)break;return u._promise("readwrite",function(){return l(a)},!0);case"deleteRange":if(s.fire===O)break;return u._promise("readwrite",function(){return d(a)},!0)}return n.mutate(a);function l(v){var h=K.trans,y=v.keys||Pi(r,v);if(!y)throw new Error("Keys missing");return v=v.type==="add"||v.type==="put"?I(I({},v),{keys:y}):I({},v),v.type!=="delete"&&(v.values=Dt([],v.values,!0)),v.keys&&(v.keys=Dt([],v.keys,!0)),Bi(n,v,y).then(function(w){var _=y.map(function(m,g){var p=w[g],x={onerror:null,onsuccess:null};if(v.type==="delete")s.fire.call(x,m,p,h);else if(v.type==="add"||p===void 0){var S=c.fire.call(x,m,v.values[g],h);m==null&&S!=null&&(m=S,v.keys[g]=m,r.outbound||J(v.values[g],r.keyPath,m))}else{var E=pn(p,v.values[g]),T=f.fire.call(x,E,m,p,h);if(T){var k=v.values[g];Object.keys(T).forEach(function(R){Y(k,R)?k[R]=T[R]:J(k,R,T[R])})}}return x});return n.mutate(v).then(function(m){for(var g=m.failures,p=m.results,x=m.numFailures,S=m.lastResult,E=0;E<y.length;++E){var T=p?p[E]:y[E],k=_[E];T==null?k.onerror&&k.onerror(g[E]):k.onsuccess&&k.onsuccess(v.type==="put"&&w[E]?v.values[E]:T)}return{failures:g,results:p,numFailures:x,lastResult:S}}).catch(function(m){return _.forEach(function(g){return g.onerror&&g.onerror(m)}),Promise.reject(m)})})}function d(v){return b(v.trans,v.range,1e4)}function b(v,h,y){return n.query({trans:v,values:!1,query:{index:r,range:h},limit:y}).then(function(w){var _=w.result;return l({type:"delete",keys:_,trans:v}).then(function(m){return m.numFailures>0?Promise.reject(m.failures[0]):_.length<y?{failures:[],numFailures:0,lastResult:void 0}:b(v,I(I({},h),{lower:_[_.length-1],lowerOpen:!0}),y)})})}}});return i}})}};function Bi(t,e,n){return e.type==="add"?Promise.resolve([]):t.getMany({trans:e.trans,keys:n,cache:"immutable"})}function lr(t,e,n){try{if(!e||e.keys.length<t.length)return null;for(var r=[],i=0,a=0;i<e.keys.length&&a<t.length;++i)W(e.keys[i],t[a])===0&&(r.push(n?Ye(e.values[i]):e.values[i]),++a);return r.length===t.length?r:null}catch{return null}}var Oi={stack:"dbcore",level:-1,create:function(t){return{table:function(e){var n=t.table(e);return I(I({},n),{getMany:function(r){if(!r.cache)return n.getMany(r);var i=lr(r.keys,r.trans._cache,r.cache==="clone");return i?A.resolve(i):n.getMany(r).then(function(a){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?Ye(a):a},a})},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}},kt;function yn(t){return!("from"in t)}var re=function(t,e){if(this)U(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0});else{var n=new re;return t&&"d"in t&&U(n,t),n}};Ce(re.prototype,(kt={add:function(t){return mt(this,t),this},addKey:function(t){return He(this,t,t),this},addKeys:function(t){var e=this;return t.forEach(function(n){return He(e,n,n)}),this}},kt[Rt]=function(){return $t(this)},kt));function He(t,e,n){var r=W(e,n);if(!isNaN(r)){if(r>0)throw RangeError();if(yn(t))return U(t,{from:e,to:n,d:1});var i=t.l,a=t.r;if(W(n,t.from)<0)return i?He(i,e,n):t.l={from:e,to:n,d:1,l:null,r:null},kn(t);if(W(e,t.to)>0)return a?He(a,e,n):t.r={from:e,to:n,d:1,l:null,r:null},kn(t);W(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),W(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);var u=!t.r;i&&!t.l&&mt(t,i),a&&u&&mt(t,a)}}function mt(t,e){function n(r,i){var a=i.from,u=i.to,o=i.l,s=i.r;He(r,a,u),o&&n(r,o),s&&n(r,s)}yn(e)||n(t,e)}function Mi(t,e){var n=$t(e),r=n.next();if(r.done)return!1;for(var i=r.value,a=$t(t),u=a.next(i.from),o=u.value;!r.done&&!u.done;){if(W(o.from,i.to)<=0&&W(o.to,i.from)>=0)return!0;W(i.from,o.from)<0?i=(r=n.next(o.from)).value:o=(u=a.next(i.from)).value}return!1}function $t(t){var e=yn(t)?null:{s:0,n:t};return{next:function(n){for(var r=arguments.length>0;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&W(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||W(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function kn(t){var e,n,r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),i=r>1?"r":r<-1?"l":"";if(i){var a=i==="r"?"l":"r",u=I({},t),o=t[i];t.from=o.from,t.to=o.to,t[i]=o[i],u[i]=o[a],t[a]=u,u.d=Dn(u)}t.d=Dn(t)}function Dn(t){var e=t.r,n=t.l;return(e?n?Math.max(e.d,n.d):e.d:n?n.d:0)+1}var Fi={stack:"dbcore",level:0,create:function(t){var e=t.schema.name,n=new re(t.MIN_KEY,t.MAX_KEY);return I(I({},t),{table:function(r){var i=t.table(r),a=i.schema,u=a.primaryKey,o=u.extractKey,s=u.outbound,c=I(I({},i),{mutate:function(d){var b=d.trans,v=b.mutatedParts||(b.mutatedParts={}),h=function(S){var E="idb://"+e+"/"+r+"/"+S;return v[E]||(v[E]=new re)},y=h(""),w=h(":dels"),_=d.type,m=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[],g=m[0],p=m[1],x=d.trans._cache;return i.mutate(d).then(function(S){if(z(g)){_!=="delete"&&(g=S.results),y.addKeys(g);var E=lr(g,x);!E&&_!=="add"&&w.addKeys(g),(E||p)&&ji(h,a,E,p)}else if(g){var T={from:g.lower,to:g.upper};w.add(T),y.add(T)}else y.add(n),w.add(n),a.indexes.forEach(function(k){return h(k.name).add(n)});return S})}}),f=function(d){var b,v,h=d.query,y=h.index,w=h.range;return[y,new re((b=w.lower)!==null&&b!==void 0?b:t.MIN_KEY,(v=w.upper)!==null&&v!==void 0?v:t.MAX_KEY)]},l={get:function(d){return[u,new re(d.key)]},getMany:function(d){return[u,new re().addKeys(d.keys)]},count:f,query:f,openCursor:f};return j(l).forEach(function(d){c[d]=function(b){var v=K.subscr;if(v){var h=function(x){var S="idb://"+e+"/"+r+"/"+x;return v[S]||(v[S]=new re)},y=h(""),w=h(":dels"),_=l[d](b),m=_[0],g=_[1];if(h(m.name||"").add(g),!m.isPrimaryKey)if(d==="count")w.add(n);else{var p=d==="query"&&s&&b.values&&i.query(I(I({},b),{values:!1}));return i[d].apply(this,arguments).then(function(x){if(d==="query"){if(s&&b.values)return p.then(function(k){var R=k.result;return y.addKeys(R),x});var S=b.values?x.result.map(o):x.result;b.values?y.addKeys(S):w.addKeys(S)}else if(d==="openCursor"){var E=x,T=b.values;return E&&Object.create(E,{key:{get:function(){return w.addKey(E.primaryKey),E.key}},primaryKey:{get:function(){var k=E.primaryKey;return w.addKey(k),k}},value:{get:function(){return T&&y.addKey(E.primaryKey),E.value}}})}return x})}}return i[d].apply(this,arguments)}}),c}})}};function ji(t,e,n,r){function i(a){var u=t(a.name||"");function o(c){return c!=null?a.extractKey(c):null}var s=function(c){return a.multiEntry&&z(c)?c.forEach(function(f){return u.addKey(f)}):u.addKey(c)};(n||r).forEach(function(c,f){var l=n&&o(n[f]),d=r&&o(r[f]);W(l,d)!==0&&(l!=null&&s(l),d!=null&&s(d))})}e.indexes.forEach(i)}var mn=function(){function t(e,n){var r=this;this._middlewares={},this.verno=0;var i=t.dependencies;this._options=n=I({addons:t.addons,autoOpen:!0,indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};var a=n.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:O,dbReadyPromise:null,cancelOpen:O,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};u.dbReadyPromise=new A(function(o){u.dbReadyResolve=o}),u.openCanceller=new A(function(o,s){u.cancelOpen=s}),this._state=u,this.name=e,this.on=qe(this,"populate","blocked","versionchange","close",{ready:[an,O]}),this.on.ready.subscribe=Mn(this.on.ready.subscribe,function(o){return function(s,c){t.vip(function(){var f=r._state;if(f.openComplete)f.dbOpenError||A.resolve().then(s),c&&o(s);else if(f.onReadyBeingFired)f.onReadyBeingFired.push(s),c&&o(s);else{o(s);var l=r;c||o(function d(){l.on.ready.unsubscribe(s),l.on.ready.unsubscribe(d)})}})}}),this.Collection=Zr(this),this.Table=Xr(this),this.Transaction=oi(this),this.Version=Ei(this),this.WhereClause=ai(this),this.on("versionchange",function(o){o.newVersion>0?console.warn("Another connection wants to upgrade database '"+r.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+r.name+"'. Closing db now to resume the delete request."),r.close()}),this.on("blocked",function(o){!o.newVersion||o.newVersion<o.oldVersion?console.warn("Dexie.delete('"+r.name+"') was blocked"):console.warn("Upgrade '"+r.name+"' blocked by other connection holding version "+o.oldVersion/10)}),this._maxKey=Ue(n.IDBKeyRange),this._createTransaction=function(o,s,c,f){return new r.Transaction(o,s,c,r._options.chromeTransactionDurability,f)},this._fireOnBlocked=function(o){r.on("blocked").fire(o),Fe.filter(function(s){return s.name===r.name&&s!==r&&!s._state.vcFired}).map(function(s){return s.on("versionchange").fire(o)})},this.use(Ii),this.use(Ri),this.use(Fi),this.use(Oi),this.vip=Object.create(this,{_vip:{value:!0}}),a.forEach(function(o){return o(r)})}return t.prototype.version=function(e){if(isNaN(e)||e<.1)throw new C.Type("Given version is not a positive number");if(e=Math.round(e*10)/10,this.idbdb||this._state.isBeingOpened)throw new C.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var n=this._versions,r=n.filter(function(i){return i._cfg.version===e})[0];return r||(r=new this.Version(e),n.push(r),n.sort(vi),r.stores({}),this._state.autoSchema=!1,r)},t.prototype._whenReady=function(e){var n=this;return this.idbdb&&(this._state.openComplete||K.letThrough||this._vip)?e():new A(function(r,i){if(n._state.openComplete)return i(new C.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen){i(new C.DatabaseClosed);return}n.open().catch(O)}n._state.dbReadyPromise.then(r,i)}).then(e)},t.prototype.use=function(e){var n=e.stack,r=e.create,i=e.level,a=e.name;a&&this.unuse({stack:n,name:a});var u=this._middlewares[n]||(this._middlewares[n]=[]);return u.push({stack:n,create:r,level:i==null?10:i,name:a}),u.sort(function(o,s){return o.level-s.level}),this},t.prototype.unuse=function(e){var n=e.stack,r=e.name,i=e.create;return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(function(a){return i?a.create!==i:r?a.name!==r:!1})),this},t.prototype.open=function(){return Ci(this)},t.prototype._close=function(){var e=this._state,n=Fe.indexOf(this);if(n>=0&&Fe.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new A(function(r){e.dbReadyResolve=r}),e.openCanceller=new A(function(r,i){e.cancelOpen=i})},t.prototype.close=function(){this._close();var e=this._state;this._options.autoOpen=!1,e.dbOpenError=new C.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)},t.prototype.delete=function(){var e=this,n=arguments.length>0,r=this._state;return new A(function(i,a){var u=function(){e.close();var o=e._deps.indexedDB.deleteDatabase(e.name);o.onsuccess=F(function(){Si(e._deps,e.name),i()}),o.onerror=ee(a),o.onblocked=e._fireOnBlocked};if(n)throw new C.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(u):u()})},t.prototype.backendDB=function(){return this.idbdb},t.prototype.isOpen=function(){return this.idbdb!==null},t.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},t.prototype.hasFailed=function(){return this._state.dbOpenError!==null},t.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(t.prototype,"tables",{get:function(){var e=this;return j(this._allTables).map(function(n){return e._allTables[n]})},enumerable:!1,configurable:!0}),t.prototype.transaction=function(){var e=ki.apply(this,arguments);return this._transaction.apply(this,e)},t.prototype._transaction=function(e,n,r){var i=this,a=K.trans;(!a||a.db!==this||e.indexOf("!")!==-1)&&(a=null);var u=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var o,s;try{if(s=n.map(function(f){var l=f instanceof i.Table?f.name:f;if(typeof l!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return l}),e=="r"||e===At)o=At;else if(e=="rw"||e==Kt)o=Kt;else throw new C.InvalidArgument("Invalid transaction mode: "+e);if(a){if(a.mode===At&&o===Kt)if(u)a=null;else throw new C.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a&&s.forEach(function(f){if(a&&a.storeNames.indexOf(f)===-1)if(u)a=null;else throw new C.SubTransaction("Table "+f+" not included in parent transaction.")}),u&&a&&!a.active&&(a=null)}}catch(f){return a?a._promise(null,function(l,d){d(f)}):L(f)}var c=cr.bind(null,this,o,s,a,r);return a?a._promise(o,c,"lock"):K.trans?Pe(K.transless,function(){return i._whenReady(c)}):this._whenReady(c)},t.prototype.table=function(e){if(!Y(this._allTables,e))throw new C.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},t}(),Li=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Ni=function(){function t(e){this._subscribe=e}return t.prototype.subscribe=function(e,n,r){return this._subscribe(!e||typeof e=="function"?{next:e,error:n,complete:r}:e)},t.prototype[Li]=function(){return this},t}();function fr(t,e){return j(e).forEach(function(n){var r=t[n]||(t[n]=new re);mt(r,e[n])}),t}function Vi(t){return new Ni(function(e){var n=tn(t);function r(b){n&&Ie();var v=function(){return ve(t,{subscr:b,trans:null})},h=K.trans?Pe(K.transless,v):v();return n&&h.then(se,se),h}var i=!1,a={},u={},o={get closed(){return i},unsubscribe:function(){i=!0,ye.storagemutated.unsubscribe(l)}};e.start&&e.start(o);var s=!1,c=!1;function f(){return j(u).some(function(b){return a[b]&&Mi(a[b],u[b])})}var l=function(b){fr(a,b),f()&&d()},d=function(){if(!(s||i)){a={};var b={},v=r(b);c||(ye(We,l),c=!0),s=!0,Promise.resolve(v).then(function(h){s=!1,!i&&(f()?d():(a={},u=b,e.next&&e.next(h)))},function(h){s=!1,e.error&&e.error(h),o.unsubscribe()})}};return d(),o})}var Zt;try{Zt={indexedDB:M.indexedDB||M.mozIndexedDB||M.webkitIndexedDB||M.msIndexedDB,IDBKeyRange:M.IDBKeyRange||M.webkitIDBKeyRange}}catch{Zt={indexedDB:null,IDBKeyRange:null}}var me=mn;Ce(me,I(I({},wt),{delete:function(t){var e=new me(t,{addons:[]});return e.delete()},exists:function(t){return new me(t,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){try{return Ai(me.dependencies).then(t)}catch{return L(new C.MissingAPI)}},defineClass:function(){function t(e){U(this,e)}return t},ignoreTransaction:function(t){return K.trans?Pe(K.transless,t):t()},vip:qt,async:function(t){return function(){try{var e=Jt(t.apply(this,arguments));return!e||typeof e.then!="function"?A.resolve(e):e}catch(n){return L(n)}}},spawn:function(t,e,n){try{var r=Jt(t.apply(n,e||[]));return!r||typeof r.then!="function"?A.resolve(r):r}catch(i){return L(i)}},currentTransaction:{get:function(){return K.trans||null}},waitFor:function(t,e){var n=A.resolve(typeof t=="function"?me.ignoreTransaction(t):t).timeout(e||6e4);return K.trans?K.trans.waitFor(n):n},Promise:A,debug:{get:function(){return te},set:function(t){zn(t,t==="dexie"?function(){return!0}:nr)}},derive:ke,extend:U,props:Ce,override:Mn,Events:qe,on:ye,liveQuery:Vi,extendObservabilitySet:fr,getByKeyPath:ue,setByKeyPath:J,delByKeyPath:br,shallowClone:Ln,deepClone:Ye,getObjectDiff:pn,cmp:W,asap:Fn,minKey:Ut,addons:[],connections:Fe,errnames:rn,dependencies:Zt,semVer:En,version:En.split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,n*2)})}));me.maxKey=Ue(me.dependencies.IDBKeyRange);typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ye(We,function(t){if(!ae){var e;_t?(e=document.createEvent("CustomEvent"),e.initCustomEvent(de,!0,!0,t)):e=new CustomEvent(de,{detail:t}),ae=!0,dispatchEvent(e),ae=!1}}),addEventListener(de,function(t){var e=t.detail;ae||gt(e)}));function gt(t){var e=ae;try{ae=!0,ye.storagemutated.fire(t)}finally{ae=e}}var ae=!1;if(typeof BroadcastChannel<"u"){var In=new BroadcastChannel(de);ye(We,function(t){ae||In.postMessage(t)}),In.onmessage=function(t){t.data&&gt(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){ye(We,function(t){try{ae||(typeof localStorage<"u"&&localStorage.setItem(de,JSON.stringify({trig:Math.random(),changedParts:t})),typeof self.clients=="object"&&Dt([],self.clients.matchAll({includeUncontrolled:!0}),!0).forEach(function(e){return e.postMessage({type:de,changedParts:t})}))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",function(t){if(t.key===de){var e=JSON.parse(t.newValue);e&&gt(e.changedParts)}});var Pn=self.document&&navigator.serviceWorker;Pn&&Pn.addEventListener("message",zi)}function zi(t){var e=t.data;e&&e.type===de&&gt(e.changedParts)}A.rejectionMapper=Cr;zn(te,nr);const gn=new mn("yourDictDB");gn.version(1).stores({dict:"word"});function hr(t){for(const e in t)typeof t[e]=="string"&&(t[e]=t[e].replaceAll("\\n",`
`));return t}async function Wi(t){const e=new Bn.Query("Dict");e.containedIn("word",t.words),t.onlyTranslation&&e.select(["translation","word"]);try{const n=await e.find(),r={};for(const i of n)r[i.attributes.word]=hr(i.attributes);return r}catch(n){return console.log(n),n}}async function Ui(t,e){const n=new Bn.Query("Dict");n.equalTo("word",t),e&&n.select(["translation"]);try{const r=await n.first(),i=r==null?void 0:r.attributes;return hr(i||{}),i}catch(r){return console.log(r),r}}async function Hi(t){const e={};for(const n of t.words){const r=await dr(n,t.onlyTranslation);r&&(e[n]=r)}return e}async function dr(t,e){return await gn.dict.get(t)}async function Rn(t){let e=0;for(const n in t)try{const r=await gn.dict.add(t[n]);e++}catch(r){console.log(r)}console.log("\u5DF2\u4FDD\u5B58",e)}async function Qi(t,e){const n=await dr(t);return n||await Ui(t,e)}async function Xi(t){await Rn();const e=await Hi(t);let n=t.words.filter(i=>!e[i]);if(console.log("\u9700\u8981\u67E5\u8BE2",t.words.length),console.log("\u4ECE\u672C\u5730\u52A0\u8F7D",Object.keys(e).length),console.log("\u8FD8\u9700\u8981\u4E0B\u8F7D",n.length),!n.length)return e;const r=Math.ceil(n.length/100);for(let i=0;i<r;i++){const a=await Wi({...t,words:n.slice(i*100,(i+1)*100-1)});Rn(a),Object.assign(e,a)}return console.log("\u6709\u7FFB\u8BD1\u7684\u8BCD\u6C47",Object.keys(e).length),e}export{Xi as a,Qi as g};
