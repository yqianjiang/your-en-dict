import{g as V,r as U,aH as B,C as j,D as F,o as w,i as m,j as r,t as i,aJ as L,p as k,k as l,x as D,m as d,F as h,l as R,q as f,aK as q,I as H,al as I}from"./main.js";import{a as T}from"./articles.js";import{u as W}from"./userDict.js";import{g as K,a as M}from"./dict.js";import{c as z,f as _}from"./counter.js";import{_ as E,N as J,a as N}from"./popup.js";import{s as O,N as P,a as G,W as C}from"./wordList.js";import{_ as Q}from"./-plugin-vue-export-helper.js";import{b as X}from"./Suffix.js";import{N as Y}from"./Select.js";const Z={class:"sticky-top"},nn=f(" \u8BCD\u8868 "),on={class:"article"},en=["data-token"],tn=f(" "+i(" ")),sn={__name:"article",setup(an){const $=V(),u=U({}),o=B({knownWord:[],unseenWord:[],unknownWord:[],translations:{}}),t=B({markUnknownWord:!1,highlight:!0,showTrans:!1,showByTokens:!0,allowRemove:!1}),p=U(O[0].value),x=s=>{var e,a,c,g;s=_(s);const n=(g=(c=(a=(e=o.translations[s])==null?void 0:e.translation)==null?void 0:a.split(".")[1])==null?void 0:c.split(",")[0])==null?void 0:g.split("\\")[0];return t.showTrans&&n?`${n.trim()}`:""},b=async s=>{if(typeof s=="string"){const n=await K(s);o.translations[s]=n,console.log(n)}else{const n=await M({words:s});Object.assign(o.translations,n),console.log(n)}},A=async s=>{var e;let n=(e=s.target)==null?void 0:e.getAttribute("data-token");!n||(n=_(n),t.markUnknownWord?o.unknownWord.includes(n)?(o.knownWord.push(n),o.unknownWord=o.unknownWord.filter(a=>a!==n),delete o.translations[n]):(o.unknownWord.push(n),o.knownWord=o.knownWord.filter(a=>a!==n),o.unseenWord=o.unseenWord.filter(a=>a!==n),b(n)):n in o.translations?delete o.translations[n]:b(n))},S=()=>{W.addKnownWords([...o.knownWord,...o.unseenWord]),W.addUnknownWords(o.unknownWord),W.save(),T.markArticle("hasMarked",u.value),t.markUnknownWord=!1,o.unseenWord=[],console.log(o),console.log(W.unknownWords),console.log(W.knownWords)};function y(s,n){s==="unknown"?(o.knownWord.push(n),o.unknownWord=o.unknownWord.filter(e=>e!==n)):s==="known"?(o.unknownWord.push(n),o.knownWord=o.knownWord.filter(e=>e!==n)):(o.knownWord.push(n),o.unseenWord=o.unseenWord.filter(e=>e!==n))}return j(async()=>{const s=$.params.id,n=await T.getArticle(s);u.value=n,document.title=n.title+" - \u4F60\u7684\u5B9A\u5236\u82F1\u8BED\u8BCD\u5178";const{known:e,unknown:a,unseen:c}=z(u.value.wordsUnique,W.knownWords,W.unknownWords);o.unknownWord=a,o.unseenWord=c,o.knownWord=e,T.markArticle("hasOpened",u.value),b([...o.unknownWord,...o.unseenWord])}),F(()=>{W.save()}),(s,n)=>(w(),m(h,null,[r("h2",null,i(u.value.title),1),u.value.tag?(w(),L(l(X),{key:0,type:"info"},{default:k(()=>[f(i(u.value.tag),1)]),_:1})):D("",!0),r("div",Z,[r("div",null," \u5171"+i(u.value.totalWords)+"\u8BCD\uFF0C\u751F\u8BCD\u7387"+i((o.unknownWord.length/(o.knownWord.length+o.unknownWord.length)*100).toFixed(2))+"% ",1),Object.keys(o.translations).length?(w(),m("button",{key:0,onClick:n[0]||(n[0]=e=>t.showTrans=!t.showTrans)},i(t.showTrans?"\u9690\u85CF":"\u663E\u793A")+"\u8BCD\u8BD1 ",1)):D("",!0),r("button",{onClick:n[1]||(n[1]=e=>t.showByTokens=!t.showByTokens)},"\u6A21\u5F0F\u5207\u6362"),r("button",{onClick:n[2]||(n[2]=e=>t.highlight=!t.highlight)},"\u9AD8\u4EAE\u5F00\u5173"),r("button",{onClick:n[3]||(n[3]=e=>t.markUnknownWord=!t.markUnknownWord)},i(t.markUnknownWord?"\u505C\u6B62\u6807\u8BB0":"\u6807\u8BB0\u751F\u8BCD"),1),r("button",{onClick:S},"\u66F4\u65B0\u8BCD\u8868"),d(E,{btnText:"\u663E\u793A\u8BCD\u8868"},{header:k(()=>[d(l(P),null,{default:k(()=>[nn,d(l(Y),{value:p.value,"onUpdate:value":n[4]||(n[4]=e=>p.value=e),options:l(O),placeholder:"\u6392\u5E8F\u65B9\u5F0F"},null,8,["value","options"]),d(l(G),{onClick:n[5]||(n[5]=e=>t.allowRemove=!t.allowRemove)},{default:k(()=>[f(i(t.allowRemove?"\u53D6\u6D88":"")+"\u7F16\u8F91 ",1)]),_:1})]),_:1})]),default:k(()=>[d(l(J),{type:"segment"},{default:k(()=>[d(l(N),{name:"0",tab:`\u751F\u8BCD (\u5171${o.unknownWord.length}\u4E2A)`},{default:k(()=>[d(C,{words:o.unknownWord,wordDict:o.translations,selectedOrder:p.value,allowRemove:t.allowRemove,onRemove:n[6]||(n[6]=e=>y("unknown",e))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),d(l(N),{name:"1",tab:`\u672A\u6807\u8BB0\u8BCD (\u5171${o.unseenWord.length}\u4E2A)`},{default:k(()=>[d(C,{words:o.unseenWord,wordDict:o.translations,selectedOrder:p.value,allowRemove:t.allowRemove,onRemove:n[7]||(n[7]=e=>y("unseen",e))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),d(l(N),{name:"2",tab:`\u719F\u8BCD (\u5171${o.knownWord.length}\u4E2A)`},{default:k(()=>[d(C,{words:o.knownWord,wordDict:o.translations,selectedOrder:p.value,allowRemove:t.allowRemove,onRemove:n[8]||(n[8]=e=>y("known",e))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"])]),_:1})]),_:1})]),r("p",on,[(w(!0),m(h,null,R(u.value.sentences,(e,a)=>(w(),m("p",{key:"paragraph"+a},[(w(!0),m(h,null,R(e,(c,g)=>(w(),m("span",{key:c.sentence.slice(0,5)+g},[r("span",{class:"origin-sentence",onClick:A},[(w(!0),m(h,null,R(c.tokens,v=>(w(),m("span",{class:q({"token--unseen":t.highlight&&o.unseenWord.includes(l(_)(v)),"token--unknown":t.highlight&&o.unknownWord.includes(l(_)(v))})},[r("ruby",{"data-token":v},[f(i(v),1),r("rt",null,i(x(v)),1)],8,en),tn],2))),256))]),H(r("div",{class:"translate-sentence"},i(c.translation),513),[[I,!t.showByTokens]])]))),128))]))),128))])],64))}},vn=Q(sn,[["__scopeId","data-v-0cce7afa"]]);export{vn as default};
