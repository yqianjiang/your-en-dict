import{aM as j,r as A,o as c,c as v,a as d,e as l,Y as S,d as m,g as y,u as i,f as V,b as u,F as p,X as B,aN as M,w as H,aH as I,a5 as q,ad as z,n as E}from"./main.js";import{a as x}from"./articles.js";import{f as U,c as K}from"./counter.js";import{u as W}from"./userDict.js";import{g as P,a as X}from"./dict.js";import{s as F,W as C}from"./WordList.js";import{N as Y,a as $,_ as G}from"./Popup.js";import{_ as L}from"./-plugin-vue-export-helper.js";import{N as J}from"./Tag.js";import{a as Q,N as Z}from"./Space.js";import{N as _}from"./Select.js";import"./lc.js";import"./Suffix.js";import"./use-form-item.js";const nn={class:"sticky-top"},en=y(" \u8BCD\u8868 "),tn={class:"article"},on=["data-token"],an=y(" "+l(" ")),sn={__name:"ReadingView",props:{article:{type:Object},data:{type:Object},toggleTrans:{type:Function},onRemove:{type:Function}},emits:["updateUserDict"],setup(t,{emit:N}){const{article:g,data:e,toggleTrans:D,onRemove:f}=t,O=()=>{N("updateUserDict"),o.markUnknownWord=!1},o=j({markUnknownWord:!1,highlight:!0,showTrans:!1,showByTokens:!0,allowRemove:!1}),a=A(F[0].value),s=k=>{var r,b,h,T;k=U(k);const n=(T=(h=(b=(r=e.translations[k])==null?void 0:r.translation)==null?void 0:b.split(".")[1])==null?void 0:h.split(",")[0])==null?void 0:T.split("\\")[0];return o.showTrans&&n?`${n.trim()}`:""},w=async k=>{var r;let n=(r=k.target)==null?void 0:r.getAttribute("data-token");!n||(n=U(n),o.markUnknownWord?e.unknownWord.includes(n)?f("unknown",n):e.knownWord.includes(n)?f("known",n):f("unseen",n):D(n))};return(k,n)=>(c(),v(p,null,[d("h2",null,l(t.article.title),1),t.article.tag?(c(),S(i(J),{key:0,type:"info"},{default:m(()=>[y(l(t.article.tag),1)]),_:1})):V("",!0),d("div",nn,[d("div",null," \u5171"+l(t.article.totalWords)+"\u8BCD\uFF0C\u751F\u8BCD\u7387"+l((t.data.unknownWord.length/(t.data.knownWord.length+t.data.unknownWord.length)*100).toFixed(2))+"% ",1),Object.keys(t.data.translations).length?(c(),v("button",{key:0,onClick:n[0]||(n[0]=r=>o.showTrans=!o.showTrans)},l(o.showTrans?"\u9690\u85CF":"\u663E\u793A")+"\u8BCD\u8BD1 ",1)):V("",!0),d("button",{onClick:n[1]||(n[1]=r=>o.showByTokens=!o.showByTokens)},l(o.showByTokens?"\u663E\u793A":"\u9690\u85CF")+"\u53E5\u8BD1",1),d("button",{onClick:n[2]||(n[2]=r=>o.markUnknownWord=!o.markUnknownWord)},l(o.markUnknownWord?"\u505C\u6B62\u6807\u8BB0":"\u5F00\u59CB\u6807\u8BB0"),1),d("button",{onClick:O},"\u66F4\u65B0\u8BCD\u8868"),u(G,{btnText:"\u67E5\u770B\u8BCD\u8868"},{header:m(()=>[u(i(Q),null,{default:m(()=>[en,u(i(_),{value:a.value,"onUpdate:value":n[3]||(n[3]=r=>a.value=r),options:i(F),placeholder:"\u6392\u5E8F\u65B9\u5F0F"},null,8,["value","options"]),u(i(Z),{onClick:n[4]||(n[4]=r=>o.allowRemove=!o.allowRemove)},{default:m(()=>[y(l(o.allowRemove?"\u53D6\u6D88":"")+"\u7F16\u8F91 ",1)]),_:1})]),_:1})]),default:m(()=>[u(i(Y),{type:"segment"},{default:m(()=>[u(i($),{name:"0",tab:`\u751F\u8BCD (\u5171${t.data.unknownWord.length}\u4E2A)`},{default:m(()=>[u(C,{words:t.data.unknownWord,wordDict:t.data.translations,selectedOrder:a.value,allowRemove:o.allowRemove,onRemove:n[5]||(n[5]=r=>t.onRemove("unknown",r))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),u(i($),{name:"1",tab:`\u672A\u6807\u8BB0\u8BCD (\u5171${t.data.unseenWord.length}\u4E2A)`},{default:m(()=>[u(C,{words:t.data.unseenWord,wordDict:t.data.translations,selectedOrder:a.value,allowRemove:o.allowRemove,onRemove:n[6]||(n[6]=r=>t.onRemove("unseen",r))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),u(i($),{name:"2",tab:`\u719F\u8BCD (\u5171${t.data.knownWord.length}\u4E2A)`},{default:m(()=>[u(C,{words:t.data.knownWord,wordDict:t.data.translations,selectedOrder:a.value,allowRemove:o.allowRemove,onRemove:n[7]||(n[7]=r=>t.onRemove("known",r))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"])]),_:1})]),_:1})]),d("p",tn,[(c(!0),v(p,null,B(t.article.sentences,(r,b)=>(c(),v("p",{key:"paragraph"+b},[(c(!0),v(p,null,B(r,(h,T)=>(c(),v("span",{key:h.sentence.slice(0,5)+T},[d("span",{class:"origin-sentence",onClick:w},[(c(!0),v(p,null,B(h.tokens,R=>(c(),v("span",{class:M({"token--unseen":o.highlight&&t.data.unseenWord.includes(i(U)(R)),"token--unknown":o.highlight&&t.data.unknownWord.includes(i(U)(R))})},[d("ruby",{"data-token":R},[y(l(R),1),d("rt",null,l(s(R)),1)],8,on),an],2))),256))]),H(d("div",{class:"translate-sentence"},l(h.translation),513),[[I,!o.showByTokens]])]))),128))]))),128))])],64))}},rn=L(sn,[["__scopeId","data-v-8d164cfb"]]);const ln={__name:"article",setup(t){const N=q(),g=A({}),e=j({knownWord:[],unseenWord:[],unknownWord:[],translations:{}}),D=a=>{a in e.translations?delete e.translations[a]:f(a)},f=async a=>{if(typeof a=="string"){const s=await P(a);e.translations[a]=s,console.log(s)}else{const s=await X({words:a});Object.assign(e.translations,s),console.log(s)}},O=()=>{W.addKnownWords([...e.knownWord,...e.unseenWord]),W.addUnknownWords(e.unknownWord),W.save(),x.markArticle("hasMarked",g.value),e.unseenWord=[],console.log(e),console.log(W.unknownWords),console.log(W.knownWords)};function o(a,s){a==="unknown"?(e.knownWord.push(s),e.unknownWord=e.unknownWord.filter(w=>w!==s),delete e.translations[s]):a==="known"?(e.unknownWord.push(s),e.knownWord=e.knownWord.filter(w=>w!==s),f(s)):(e.unknownWord.push(s),e.unseenWord=e.unseenWord.filter(w=>w!==s))}return z(async()=>{const a=N.params.id,s=await x.getArticle(a);g.value=s,document.title=s.title+" - \u4F60\u7684\u5B9A\u5236\u82F1\u8BED\u8BCD\u5178";const{known:w,unknown:k,unseen:n}=K(g.value.wordsUnique,W.knownWords,W.unknownWords);e.unknownWord=k,e.unseenWord=n,e.knownWord=w,x.markArticle("hasOpened",g.value),f([...e.unknownWord,...e.unseenWord])}),E(()=>{W.save()}),(a,s)=>(c(),S(rn,{article:g.value,data:e,onUpdateUserDict:O,onRemove:o,toggleTrans:D},null,8,["article","data"]))}},Tn=L(ln,[["__scopeId","data-v-b8388e31"]]);export{Tn as default};
