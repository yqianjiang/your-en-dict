import{aM as C,o as k,c as g,a as m,e as c,Y as _,d as f,g as y,u as v,f as V,aj as A,F as U,X as O,aN as L,w as M,aH as H,r as F,b as w,a5 as I,ad as P,n as q}from"./main.js";import{f as N,c as z}from"./counter.js";import{_ as S}from"./-plugin-vue-export-helper.js";import{N as E}from"./Tag.js";import{N as $,a as K,_ as X}from"./Popup.js";import{s as j,W as B}from"./WordList.js";import{N as Y}from"./Select.js";import{N as G,a as J}from"./Space.js";import{a as x}from"./articles.js";import{u as h}from"./userDict.js";import{g as Q,a as Z}from"./dict.js";import"./Suffix.js";import"./use-form-item.js";import"./lc.js";const ee={class:"sticky-top"},ne={class:"stats-info"},te={class:"article"},oe=["data-token"],ae=y(" "+c(" ")),se={__name:"ReadingView",props:{article:{type:Object},data:{type:Object},toggleTrans:{type:Function},onRemove:{type:Function}},emits:["updateUserDict"],setup(n,{emit:W}){const{article:i,data:e,toggleTrans:d,onRemove:s}=n,D=()=>{W("updateUserDict"),a.markUnknownWord=!1},a=C({markUnknownWord:!1,highlight:!0,showTrans:!1,showByTokens:!0}),r=l=>{var u,b,p,T;l=N(l);const t=(T=(p=(b=(u=e.translations[l])==null?void 0:u.translation)==null?void 0:b.split(".")[1])==null?void 0:p.split(",")[0])==null?void 0:T.split("\\")[0];return a.showTrans&&t?`${t.trim()}`:""},o=async l=>{var u;let t=(u=l.target)==null?void 0:u.getAttribute("data-token");!t||(t=N(t),a.markUnknownWord?e.unknownWord.includes(t)?s("unknown",t):e.knownWord.includes(t)?s("known",t):s("unseen",t):d(t))};return(l,t)=>(k(),g(U,null,[m("h2",null,c(n.article.title),1),n.article.tag?(k(),_(v(E),{key:0,type:"info"},{default:f(()=>[y(c(n.article.tag),1)]),_:1})):V("",!0),m("div",ee,[m("div",ne," \u5171"+c(n.article.totalWords)+"\u8BCD\uFF0C\u751F\u8BCD\u7387"+c((n.data.unknownWord.length/(n.data.knownWord.length+n.data.unknownWord.length)*100).toFixed(2))+"% ",1),Object.keys(n.data.translations).length?(k(),g("button",{key:0,onClick:t[0]||(t[0]=u=>a.showTrans=!a.showTrans)},c(a.showTrans?"\u9690\u85CF":"\u663E\u793A")+"\u8BCD\u8BD1 ",1)):V("",!0),m("button",{onClick:t[1]||(t[1]=u=>a.showByTokens=!a.showByTokens)},c(a.showByTokens?"\u663E\u793A":"\u9690\u85CF")+"\u53E5\u8BD1",1),m("button",{onClick:t[2]||(t[2]=u=>a.markUnknownWord=!a.markUnknownWord)},c(a.markUnknownWord?"\u505C\u6B62\u6807\u8BB0":"\u5F00\u59CB\u6807\u8BB0"),1),m("button",{onClick:D},"\u66F4\u65B0\u8BCD\u8868"),A(l.$slots,"default",{},void 0,!0)]),m("p",te,[(k(!0),g(U,null,O(n.article.sentences,(u,b)=>(k(),g("p",{key:"paragraph"+b},[(k(!0),g(U,null,O(u,(p,T)=>(k(),g("span",{key:p.sentence.slice(0,5)+T},[m("span",{class:"origin-sentence",onClick:o},[(k(!0),g(U,null,O(p.tokens,R=>(k(),g("span",{class:L({"token--unseen":a.highlight&&n.data.unseenWord.includes(v(N)(R)),"token--unknown":a.highlight&&n.data.unknownWord.includes(v(N)(R))})},[m("ruby",{"data-token":R},[y(c(R),1),m("rt",null,c(r(R)),1)],8,oe),ae],2))),256))]),M(m("div",{class:"translate-sentence"},c(p.translation),513),[[H,!a.showByTokens]])]))),128))]))),128))])],64))}},re=S(se,[["__scopeId","data-v-95021274"]]),le=y(" \u8BCD\u8868 "),de={__name:"WordListPopup",props:{data:{type:Object},onRemove:{type:Function}},setup(n){const W=F(j[0].value),i=C({allowRemove:!1});return(e,d)=>(k(),_(X,{btnText:"\u67E5\u770B\u8BCD\u8868"},{header:f(()=>[w(v(J),null,{default:f(()=>[le,w(v(Y),{value:W.value,"onUpdate:value":d[0]||(d[0]=s=>W.value=s),options:v(j),placeholder:"\u6392\u5E8F\u65B9\u5F0F"},null,8,["value","options"]),w(v(G),{onClick:d[1]||(d[1]=s=>i.allowRemove=!i.allowRemove)},{default:f(()=>[y(c(i.allowRemove?"\u53D6\u6D88":"")+"\u7F16\u8F91 ",1)]),_:1})]),_:1})]),default:f(()=>[w(v(K),{type:"segment"},{default:f(()=>[w(v($),{name:"0",tab:`\u751F\u8BCD (\u5171${n.data.unknownWord.length}\u4E2A)`},{default:f(()=>[w(B,{words:n.data.unknownWord,wordDict:n.data.translations,selectedOrder:W.value,allowRemove:i.allowRemove,onRemove:d[2]||(d[2]=s=>n.onRemove("unknown",s))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),w(v($),{name:"1",tab:`\u672A\u6807\u8BB0\u8BCD (\u5171${n.data.unseenWord.length}\u4E2A)`},{default:f(()=>[w(B,{words:n.data.unseenWord,wordDict:n.data.translations,selectedOrder:W.value,allowRemove:i.allowRemove,onRemove:d[3]||(d[3]=s=>n.onRemove("unseen",s))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),w(v($),{name:"2",tab:`\u719F\u8BCD (\u5171${n.data.knownWord.length}\u4E2A)`},{default:f(()=>[w(B,{words:n.data.knownWord,wordDict:n.data.translations,selectedOrder:W.value,allowRemove:i.allowRemove,onRemove:d[4]||(d[4]=s=>n.onRemove("known",s))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"])]),_:1})]),_:1}))}};const ie={__name:"article",setup(n){const W=I(),i=F({}),e=C({knownWord:[],unseenWord:[],unknownWord:[],translations:{}}),d=r=>{r in e.translations?delete e.translations[r]:s(r)},s=async r=>{if(typeof r=="string"){const o=await Q(r);e.translations[r]=o,console.log(o)}else{const o=await Z({words:r});Object.assign(e.translations,o),console.log(o)}},D=()=>{h.addKnownWords([...e.knownWord,...e.unseenWord]),h.addUnknownWords(e.unknownWord),h.save(),x.markArticle("hasMarked",i.value),e.unseenWord=[],console.log(e),console.log(h.unknownWords),console.log(h.knownWords)};function a(r,o){r==="unknown"?(e.knownWord.push(o),e.unknownWord=e.unknownWord.filter(l=>l!==o),delete e.translations[o]):r==="known"?(e.unknownWord.push(o),e.knownWord=e.knownWord.filter(l=>l!==o),s(o)):(e.unknownWord.push(o),e.unseenWord=e.unseenWord.filter(l=>l!==o))}return P(async()=>{const r=W.params.id,o=await x.getArticle(r);i.value=o,document.title=o.title+" - \u4F60\u7684\u5B9A\u5236\u82F1\u8BED\u8BCD\u5178";const{known:l,unknown:t,unseen:u}=z(i.value.wordsUnique,h.knownWords,h.unknownWords);e.unknownWord=t,e.unseenWord=u,e.knownWord=l,x.markArticle("hasOpened",i.value),s([...e.unknownWord,...e.unseenWord])}),q(()=>{h.save()}),(r,o)=>(k(),_(re,{article:i.value,data:e,onUpdateUserDict:D,onRemove:a,toggleTrans:d},{default:f(()=>[w(de,{data:e,onRemove:a},null,8,["data"])]),_:1},8,["article","data"]))}},Te=S(ie,[["__scopeId","data-v-9c66bf17"]]);export{Te as default};
