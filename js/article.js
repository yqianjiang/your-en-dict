import{g as S,r as U,aH as D,C as V,D as j,o as c,i as m,j as a,t as i,m as l,p as u,k as d,x as F,F as h,l as R,q as v,aI as I,I as L,al as q}from"./main.js";import{a as T}from"./articles.js";import{u as W}from"./userDict.js";import{g as H,a as M}from"./dict.js";import{c as z,f as _}from"./counter.js";import{_ as E,N as K,a as N}from"./popup.js";import{s as O,N as P,a as G,W as C}from"./wordList.js";import{_ as J}from"./-plugin-vue-export-helper.js";import{b as Q}from"./Suffix.js";import{N as X}from"./Select.js";import"./lc.js";const Y={class:"sticky-top"},Z=v(" \u8BCD\u8868 "),nn={class:"article"},on=["data-token"],en=v(" "+i(" ")),tn={__name:"article",setup(sn){const B=S(),w=U({}),o=D({knownWord:[],unseenWord:[],unknownWord:[],translations:{}}),t=D({markUnknownWord:!1,highlight:!0,showTrans:!1,showByTokens:!0,allowRemove:!1}),p=U(O[0].value),$=s=>{var e,r,k,g;s=_(s);const n=(g=(k=(r=(e=o.translations[s])==null?void 0:e.translation)==null?void 0:r.split(".")[1])==null?void 0:k.split(",")[0])==null?void 0:g.split("\\")[0];return t.showTrans&&n?`${n.trim()}`:""},b=async s=>{if(typeof s=="string"){const n=await H(s);o.translations[s]=n,console.log(n)}else{const n=await M({words:s});Object.assign(o.translations,n),console.log(n)}},x=async s=>{var e;let n=(e=s.target)==null?void 0:e.getAttribute("data-token");!n||(n=_(n),t.markUnknownWord?o.unknownWord.includes(n)?(o.knownWord.push(n),o.unknownWord=o.unknownWord.filter(r=>r!==n),delete o.translations[n]):(o.unknownWord.push(n),o.knownWord=o.knownWord.filter(r=>r!==n),o.unseenWord=o.unseenWord.filter(r=>r!==n),b(n)):n in o.translations?delete o.translations[n]:b(n))},A=()=>{W.addKnownWords([...o.knownWord,...o.unseenWord]),W.addUnknownWords(o.unknownWord),W.save(),T.markArticle("hasMarked",w.value),t.markUnknownWord=!1,o.unseenWord=[],console.log(o),console.log(W.unknownWords),console.log(W.knownWords)};function y(s,n){s==="unknown"?(o.knownWord.push(n),o.unknownWord=o.unknownWord.filter(e=>e!==n)):s==="known"?(o.unknownWord.push(n),o.knownWord=o.knownWord.filter(e=>e!==n)):(o.knownWord.push(n),o.unseenWord=o.unseenWord.filter(e=>e!==n))}return V(async()=>{const s=B.params.id,n=await T.getArticle(s);w.value=n,document.title=n.title+" - \u4F60\u7684\u5B9A\u5236\u82F1\u8BED\u8BCD\u5178";const{known:e,unknown:r,unseen:k}=z(w.value.wordsUnique,W.knownWords,W.unknownWords);o.unknownWord=r,o.unseenWord=k,o.knownWord=e,T.markArticle("hasOpened",w.value),b([...o.unknownWord,...o.unseenWord])}),j(()=>{W.save()}),(s,n)=>(c(),m(h,null,[a("h2",null,i(w.value.title),1),l(d(Q),{type:"info"},{default:u(()=>[v(i(w.value.tag),1)]),_:1}),a("div",Y,[a("div",null," \u5171"+i(w.value.totalWords)+"\u8BCD\uFF0C\u751F\u8BCD\u7387"+i((o.unknownWord.length/(o.knownWord.length+o.unknownWord.length)*100).toFixed(2))+"% ",1),Object.keys(o.translations).length?(c(),m("button",{key:0,onClick:n[0]||(n[0]=e=>t.showTrans=!t.showTrans)},i(t.showTrans?"\u9690\u85CF":"\u663E\u793A")+"\u8BCD\u8BD1 ",1)):F("",!0),a("button",{onClick:n[1]||(n[1]=e=>t.showByTokens=!t.showByTokens)},"\u6A21\u5F0F\u5207\u6362"),a("button",{onClick:n[2]||(n[2]=e=>t.highlight=!t.highlight)},"\u9AD8\u4EAE\u5F00\u5173"),a("button",{onClick:n[3]||(n[3]=e=>t.markUnknownWord=!t.markUnknownWord)},i(t.markUnknownWord?"\u505C\u6B62\u6807\u8BB0":"\u6807\u8BB0\u751F\u8BCD"),1),a("button",{onClick:A},"\u66F4\u65B0\u8BCD\u8868"),l(E,{btnText:"\u663E\u793A\u8BCD\u8868"},{header:u(()=>[l(d(P),null,{default:u(()=>[Z,l(d(X),{value:p.value,"onUpdate:value":n[4]||(n[4]=e=>p.value=e),options:d(O),placeholder:"\u6392\u5E8F\u65B9\u5F0F"},null,8,["value","options"]),l(d(G),{onClick:n[5]||(n[5]=e=>t.allowRemove=!t.allowRemove)},{default:u(()=>[v(i(t.allowRemove?"\u53D6\u6D88":"")+"\u7F16\u8F91 ",1)]),_:1})]),_:1})]),default:u(()=>[l(d(K),{type:"segment"},{default:u(()=>[l(d(N),{name:"0",tab:`\u751F\u8BCD (\u5171${o.unknownWord.length}\u4E2A)`},{default:u(()=>[l(C,{words:o.unknownWord,wordDict:o.translations,selectedOrder:p.value,allowRemove:t.allowRemove,onRemove:n[6]||(n[6]=e=>y("unknown",e))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),l(d(N),{name:"1",tab:`\u672A\u6807\u8BB0\u8BCD (\u5171${o.unseenWord.length}\u4E2A)`},{default:u(()=>[l(C,{words:o.unseenWord,wordDict:o.translations,selectedOrder:p.value,allowRemove:t.allowRemove,onRemove:n[7]||(n[7]=e=>y("unseen",e))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"]),l(d(N),{name:"2",tab:`\u719F\u8BCD (\u5171${o.knownWord.length}\u4E2A)`},{default:u(()=>[l(C,{words:o.knownWord,wordDict:o.translations,selectedOrder:p.value,allowRemove:t.allowRemove,onRemove:n[8]||(n[8]=e=>y("known",e))},null,8,["words","wordDict","selectedOrder","allowRemove"])]),_:1},8,["tab"])]),_:1})]),_:1})]),a("p",nn,[(c(!0),m(h,null,R(w.value.sentences,(e,r)=>(c(),m("p",{key:"paragraph"+r},[(c(!0),m(h,null,R(e,(k,g)=>(c(),m("span",{key:k.sentence.slice(0,5)+g},[a("span",{class:"origin-sentence",onClick:x},[(c(!0),m(h,null,R(k.tokens,f=>(c(),m("span",{class:I({"token--unseen":t.highlight&&o.unseenWord.includes(d(_)(f)),"token--unknown":t.highlight&&o.unknownWord.includes(d(_)(f))})},[a("ruby",{"data-token":f},[v(i(f),1),a("rt",null,i($(f)),1)],8,on),en],2))),256))]),L(a("div",{class:"translate-sentence"},i(k.translation),513),[[q,!t.showByTokens]])]))),128))]))),128))])],64))}},fn=J(tn,[["__scopeId","data-v-2efc6cde"]]);export{fn as default};
